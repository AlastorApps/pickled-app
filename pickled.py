#!/usr/bin/env python3
from flask import Flask, request, jsonify, render_template_string, send_from_directory, send_file, redirect, session
from flask_wtf.csrf import CSRFProtect, generate_csrf
from netmiko import ConnectHandler, NetMikoTimeoutException, NetMikoAuthenticationException
import io
from functools import wraps
from datetime import datetime
import time
import os
import glob
import json
import zipfile
import shutil
import csv
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
import atexit
import logging
import logging.handlers
from cryptography.fernet import Fernet
import base64
from werkzeug.utils import secure_filename
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address
import ipaddress
import re
from markupsafe import escape



__version__ = "1.1RC"

__favicon__ = "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"

__pickledlogo__ = "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"

app = Flask(__name__)
app.secret_key = os.environ.get('SECRET_KEY', os.urandom(24))  # Chiave segreta per le sessioni
app.config['WTF_CSRF_ENABLED'] = True
app.config['WTF_CSRF_SECRET_KEY'] = os.environ.get('CSRF_SECRET_KEY', os.urandom(24).hex())
csrf = CSRFProtect(app)

# Credenziali hardcoded
USERNAME = os.environ.get('PICKLED_USERNAME', 'jar')
PASSWORD = os.environ.get('PICKLED_PASSWORD', 'cucumber')



logger = logging.getLogger(__name__)

# Percorsi dei file
current_dir = os.path.dirname(os.path.abspath(__file__))
SWITCHES_FILE = os.path.join(current_dir, 'switches.json')
SCHEDULES_FILE = os.path.join(current_dir, 'schedules.json')
KEY_FILE = os.path.join(current_dir, 'encryption.key')
LOG_DIR = os.path.join(current_dir, 'logs')
EVENTS_LOG = os.path.join(LOG_DIR, 'events.log')
BACKUP_DIR = os.path.join(current_dir, 'backups')

# Crea le directory necessarie se non esistono
os.makedirs(LOG_DIR, exist_ok=True)
os.makedirs(BACKUP_DIR, exist_ok=True)

# Crea il file di log se non esiste
if not os.path.exists(EVENTS_LOG):
    open(EVENTS_LOG, 'a').close()

# Configurazione logging - SOLO QUESTA VERSIONE
logger = logging.getLogger(__name__)

# Rimuovi tutti gli handler esistenti per evitare duplicati
for handler in logger.handlers[:]:
    logger.removeHandler(handler)

# Configura il livello del logger
logger.setLevel(logging.INFO)

# Crea UN SINGOLO handler per il file di log
file_handler = logging.handlers.TimedRotatingFileHandler(
    EVENTS_LOG,
    when='midnight',
    interval=1,
    backupCount=7,  # Mantieni 7 backup
    encoding='utf-8',
    delay=False
)
file_handler.setFormatter(logging.Formatter('%(asctime)s - %(message)s'))
file_handler.suffix = "%Y-%m-%d.log"  # Formato data standard

# Aggiungi SOLO QUESTO handler
logger.addHandler(file_handler)

# Disabilita il logging di Werkzeug
logging.getLogger('werkzeug').setLevel(logging.WARNING)

# Inizializzazione dello scheduler
scheduler = BackgroundScheduler()
scheduler.start()
atexit.register(lambda: scheduler.shutdown())

limiter = Limiter(
    app=app,
    key_func=get_remote_address,
    default_limits=["200 per day", "50 per hour"],
    storage_uri="memory://",  # O usare Redis in produzione
    strategy="fixed-window"
)



app.config.update(
    SESSION_COOKIE_SECURE=False,
    SESSION_COOKIE_HTTPONLY=True,
    SESSION_COOKIE_SAMESITE='Lax',
    PERMANENT_SESSION_LIFETIME=3600
)

#def validate_input(input_str, max_length=255, allowed_chars=None):
#    if not input_str or len(input_str) > max_length:
#        return False
#    if allowed_chars:
#        for char in input_str:
#            if char not in allowed_chars:
#                return False
#    return True

def validate_ip(ip):
    try:
        ipaddress.ip_address(ip)
        return True
    except ValueError:
        return False

def validate_hostname(hostname):
    if len(hostname) > 255:
        return False
    if hostname[-1] == ".":
        hostname = hostname[:-1]
    allowed = re.compile("(?!-)[A-Z\d-]{1,63}(?<!-)$", re.IGNORECASE)
    return all(allowed.match(x) for x in hostname.split("."))

# Inizializzazione della crittografia
def get_encryption_key():
    if os.path.exists(KEY_FILE):
        with open(KEY_FILE, 'rb') as key_file:
            return key_file.read()
    else:
        key = Fernet.generate_key()
        with open(KEY_FILE, 'wb') as key_file:
            key_file.write(key)
        return key

fernet = Fernet(get_encryption_key())

def encrypt_password(password):
    if not password:
        return ""
    return fernet.encrypt(password.encode()).decode()

def decrypt_password(encrypted_password):
    if not encrypted_password:
        return ""
    return fernet.decrypt(encrypted_password.encode()).decode()

# Funzioni di persistenza dati
def load_switches():
    try:
        if not os.path.exists(SWITCHES_FILE):
            return []

        with open(SWITCHES_FILE, 'r', encoding='utf-8-sig') as f:
            content = f.read().strip()
            if not content:
                return []
            
            switches_data = json.loads(content)
            
            # Correzione: garantiamo che enable_password sia sempre valorizzato
            for switch in switches_data:
                if not switch.get('enable_password'):
                    switch['enable_password'] = switch['password']
            
            return switches_data
            
    except json.JSONDecodeError as e:
        logger.error(f"Invalid JSON in switches file: {str(e)}")
        return []
    except Exception as e:
        logger.error(f"Error loading switches: {str(e)}")
        return []

def save_switches(switches_data):
    with open(SWITCHES_FILE, 'w') as f:
        json.dump(switches_data, f, indent=4)

def load_schedules():
    try:
        if os.path.exists(SCHEDULES_FILE):
            with open(SCHEDULES_FILE, 'r') as f:
                schedules = json.load(f)
                for schedule in schedules:
                    if schedule.get('enabled', True):
                        add_scheduled_job(schedule)
                return schedules
        return []
    except (json.JSONDecodeError, FileNotFoundError) as e:
        logger.error(f"Error during schedule update: {str(e)}")
        return []

def save_schedules(schedules_data):
    with open(SCHEDULES_FILE, 'w') as f:
        json.dump(schedules_data, f, indent=4)

# Funzioni per lo scheduling
def add_scheduled_job(schedule):
    trigger = None
    schedule_type = schedule['type']
    time_str = schedule['time']
    hour, minute = map(int, time_str.split(':'))
    
    if schedule_type == 'once':
        run_date = datetime.strptime(schedule['date'], '%Y-%m-%d')
        run_date = run_date.replace(hour=hour, minute=minute)
        trigger = 'date'
        kwargs = {'run_date': run_date}
    elif schedule_type == 'daily':
        trigger = CronTrigger(hour=hour, minute=minute)
    elif schedule_type == 'weekly':
        day_of_week = schedule['day_of_week']
        trigger = CronTrigger(day_of_week=day_of_week, hour=hour, minute=minute)
    elif schedule_type == 'monthly':
        day = schedule['day']
        trigger = CronTrigger(day=day, hour=hour, minute=minute)
    elif schedule_type == 'yearly':
        month = schedule['month']
        day = schedule['day']
        trigger = CronTrigger(month=month, day=day, hour=hour, minute=minute)
    
    if trigger:
        job_func = execute_scheduled_backup if 'switch_index' in schedule else execute_global_scheduled_backup
        args = [schedule['switch_index']] if 'switch_index' in schedule else []
        
        scheduler.add_job(
            job_func,
            trigger,
            args=args,
            id=schedule['id'],
            name=f"Backup {'switch ' + str(schedule['switch_index']) if 'switch_index' in schedule else 'globale'}",
            replace_existing=True,
            **kwargs if schedule_type == 'once' else {}
        )

def execute_scheduled_backup(switch_index):
    try:
        with app.app_context():
            switches_data = load_switches()
            if 0 <= switch_index < len(switches_data):
                switch = switches_data[switch_index]
                logger.info(f"Esecuzione backup programmato per {switch['hostname']} ({switch['ip']})")
                result = backup_switch({'index': switch_index, 'scheduled': True})
                if not result.get('success', False):
                    logger.error(f"Error during scheduled backup: {result.get('message', 'Nessun dettaglio')}")
    except Exception as e:
        logger.error(f"Error during the execution of the scheduled backup: {str(e)}")

def execute_global_scheduled_backup():
    try:
        with app.app_context():
            logger.info("Global backup execution set for all devices")
            switches_data = load_switches()
            for i in range(len(switches_data)):
                execute_scheduled_backup(i)
    except Exception as e:
        logger.error(f"Error during the global backup execution: {str(e)}")

# Funzioni di utilità
def is_logged_in():
    return session.get('logged_in')

def login_required(f):
    @wraps(f)  # Importa wraps da functools
    @csrf.exempt
    def decorated_function(*args, **kwargs):
        if not is_logged_in():
            return redirect('/login')
        return f(*args, **kwargs)
    return decorated_function

def get_schedule_description(schedule):
    desc = ''
    time_str = schedule.get('time', '00:00')
    
    if schedule['type'] == 'once':
        desc = f"Una volta il {schedule['date']} alle {time_str}"
    elif schedule['type'] == 'daily':
        desc = f"Giornaliero alle {time_str}"
    elif schedule['type'] == 'weekly':
        days = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato']
        day = int(schedule['day_of_week'])
        desc = f"Settimanale ogni {days[day]} alle {time_str}"
    elif schedule['type'] == 'monthly':
        desc = f"Mensile il giorno {schedule['day']} alle {time_str}"
    elif schedule['type'] == 'yearly':
        months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre']
        month = int(schedule['month']) - 1
        desc = f"Annuale il {schedule['day']} {months[month]} alle {time_str}"
    
    return desc

@app.after_request
def set_csrf_cookie(response):
    response.set_cookie('csrf_token', generate_csrf())
    return response

@app.route('/login', methods=['GET', 'POST'])
@limiter.limit("5 per minute") 
def login():
    if request.method == 'POST':
        if request.form.get('username') == USERNAME and request.form.get('password') == PASSWORD:
            session['logged_in'] = True
            session.permanent = True
            # Assicurati che la sessione sia salvata prima del redirect
            session.modified = True
            return redirect('/')
        return '''
            <script>
                alert("Wrong credentials");
                window.location.href = "/login";
            </script>
        '''
    
    # Genera un nuovo token CSRF per il form
    csrf_token = generate_csrf()
    
    return f'''
    <!DOCTYPE html>
    <html>
    <head>
        <title>PICKLED - Login</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="icon" type="image/png" href="data:image/png;base64,{__favicon__}">
        <style>
            :root {{
                --primary-light: #0f5350;  /* Verde chiaro */
                --primary-main: #2d8371;   /* Verde medio */
                --primary-dark: #aacf76;   /* Verde scuro */
                --petrol: #02433e;        /* Verde petrolio */
                --accent-color: #ff8a65;
                --light-color: #f1f8e9;
                --dark-color: #263238;
            }}
            
            * {{
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }}
            
            body {{
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                color: var(--dark-color);
            }}
            
            .login-container {{
                background-color: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                width: 100%;
                max-width: 400px;
                padding: 40px;
                text-align: center;
                animation: fadeIn 0.5s ease-in-out;
            }}
            
            @keyframes fadeIn {{
                from {{ opacity: 0; transform: translateY(-20px); }}
                to {{ opacity: 1; transform: translateY(0); }}
            }}
            
            .logo {{
                margin-bottom: 25px;
                color: var(--petrol);
            }}
            
            .logo i {{
                font-size: 3.5rem;
                margin-bottom: 10px;
                color: var(--primary-dark);
            }}
            
            .logo h1 {{
                font-size: 1.8rem;
                margin-bottom: 5px;
            }}
            
            .logo p {{
                font-size: 0.9rem;
                color: #666;
            }}
            
            .login-form {{
                margin-top: 20px;
            }}
            
            .input-group {{
                margin-bottom: 20px;
                position: relative;
                text-align: left;
            }}
            
            .input-group label {{
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: var(--petrol);
            }}
            
            .input-group input {{
                width: 100%;
                padding: 12px 15px 12px 40px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 16px;
                transition: all 0.3s;
            }}
            
            .input-group input:focus {{
                border-color: var(--primary-main);
                box-shadow: 0 0 0 3px rgba(77, 184, 168, 0.2);
                outline: none;
            }}
            
            .input-icon {{
		position: absolute;
		left: 15px;
		top: 70%;
		transform: translateY(-50%);
		color: var(--primary-main);
		height: 1em;
		line-height: 1;
		display: flex;
		align-items: center;
            }}
            
            button {{
                width: 100%;
                padding: 14px;
                background-color: var(--petrol);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s;
                margin-top: 10px;
            }}
            
            button:hover {{
                background-color: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 105, 92, 0.3);
            }}
            

            
            .version {{
                position: absolute;
                bottom: 20px;
                left: 20px;
                color: rgba(255, 255, 255, 0.9);
                font-size: 0.7rem;
            }}
        </style>
    </head>
    <body>
        <div class="login-container">
            <div class="logo">
                <!-- <i class="fas fa-leaf"></i> -->
                <img src="data:image/png;base64,{__pickledlogo__}">
                <!-- <h1>PICKLED</h1> -->
                <p>Platform for Instant Config Keep & Lightweight Export Daemon</p>
            </div>
            
            <form method="post" action="/login" class="login-form">
                <input type="hidden" name="csrf_token" value="{csrf_token}">
                
                <div class="input-group">
                    <label for="username">Username</label>
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="username" name="username" placeholder="Inserisci il tuo username" required>
                </div>
                
                <div class="input-group">
                    <label for="password">Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="password" name="password" placeholder="Inserisci la tua password" required>
                </div>
                
                <button type="submit">
                    <i class="fas fa-sign-in-alt"></i> Accedi
                </button>
            </form>
            
        </div>
        
        <div class="version">v{__version__}</div>
    </body>
    </html>
    '''


@app.route('/logout')
def logout():
    session.pop('logged_in', None)
    return redirect('/login')

@app.route('/')
@login_required
def index():
    current_date = datetime.now().strftime('%Y-%m-%d')
    return render_template_string(HTML_TEMPLATE, current_date=current_date, favicon=__favicon__, pickledlogo=__pickledlogo__, version=__version__)

def csrf_exempt_login_required(f):
    return csrf.exempt(login_required(f))

# API per la gestione degli switch
@app.route('/add_switch', methods=['POST'])
@login_required
def add_switch():
    data = request.get_json()
    if not all(key in data for key in ['hostname', 'ip', 'username', 'password']):
        return jsonify({'success': False, 'message': 'Missing data'}), 400
    
    # Validazione lunghezza massima
    max_length = 255
    if (len(data['hostname']) > max_length or 
        len(data['ip']) > max_length or 
        len(data['username']) > max_length):
        return jsonify({'success': False, 'message': 'Input too long'}), 400
    
    # Validazione caratteri permessi (solo alfanumerici e alcuni simboli)
    if not re.match(r'^[a-zA-Z0-9\-_\.]+$', data['hostname']):
        return jsonify({'success': False, 'message': 'Invalid characters in hostname'}), 400
        
    if not all(key in data for key in ['hostname', 'ip', 'username', 'password']):
        return jsonify({'success': False, 'message': 'Missing data'})
    if not validate_ip(data['ip']):
        return jsonify({'success': False, 'message': 'Invalid IP address'})
    if not validate_hostname(data['hostname']):
        return jsonify({'success': False, 'message': 'Invalid hostname'})  
          
    # Encrypt passwords
    encrypted_password = encrypt_password(data['password'])
    # Garantiamo che enable_password sia sempre uguale a password se non specificato
    encrypted_enable = encrypt_password(data.get('enable_password', data['password']))
    
    switch_data = {
        'hostname': data['hostname'],
        'ip': data['ip'],
        'username': data['username'],
        'password': encrypted_password,
        'enable_password': encrypted_enable,
        'device_type': data.get('device_type', 'cisco_ios'),
        'last_backup_status': None,  
        'last_backup_time': None
    }
    
    switches_data = load_switches()
    switches_data.append(switch_data)
    save_switches(switches_data)
    
    logger.info(f"Added device: {data['hostname']} ({data['ip']})")
    return jsonify({'success': True, 'message': 'Device added successfully'})

@app.route('/get_switches', methods=['GET'])
@login_required
def get_switches_api():
    switches_data = load_switches()
    return jsonify(switches_data)

@app.route('/update_switch', methods=['POST'])
@login_required
def update_switch():
    data = request.get_json()
    if 'index' not in data:
        return jsonify({'success': False, 'message': 'Indice mancante'})
    
    switches_data = load_switches()
    index = int(data['index'])
    
    if 0 <= index < len(switches_data):
        old_hostname = switches_data[index]['hostname']
        
        # Keep existing passwords if not provided, otherwise encrypt new ones
        password = encrypt_password(data['password']) if 'password' in data and data['password'] else switches_data[index]['password']
        # For enable_password, use the new password if provided, otherwise keep existing enable_password
        enable_password = encrypt_password(data['enable_password']) if 'enable_password' in data and data['enable_password'] else password
        
        switches_data[index] = {
            'hostname': data['hostname'],
            'ip': data['ip'],
            'username': data['username'],
            'password': password,
            'enable_password': enable_password,
            'device_type': data.get('device_type', switches_data[index].get('device_type', 'cisco_ios'))
        }
        
        save_switches(switches_data)
        logger.info(f"Aggiornato switch: da {old_hostname} a {data['hostname']} ({data['ip']})")
        return jsonify({'success': True, 'message': 'Switch aggiornato'})
    else:
        return jsonify({'success': False, 'message': 'Indice non valido'})

@app.route('/delete_switch', methods=['POST'])
@login_required
def delete_switch():
    data = request.get_json()
    if 'index' not in data:
        return jsonify({'success': False, 'message': 'Indice mancante'})
    
    switches_data = load_switches()
    index = int(data['index'])
    
    if 0 <= index < len(switches_data):
        deleted_switch = switches_data.pop(index)
        save_switches(switches_data)
        
        schedules_data = load_schedules()
        schedules_data = [s for s in schedules_data if s.get('switch_index') != index]
        save_schedules(schedules_data)
        
        logger.info(f"Eliminato switch: {deleted_switch['hostname']} ({deleted_switch['ip']})")
        return jsonify({'success': True, 'message': 'Switch eliminato'})
    else:
        return jsonify({'success': False, 'message': 'Indice switch non valido'})

# API per la gestione dei backup
@app.route('/backup_switch', methods=['POST'])
@login_required
def backup_switch_http():
    try:
        data = request.get_json()
        if not data:
            return jsonify({'success': False, 'message': 'Invalid request data'})
            
        result = backup_switch(data)
        return jsonify(result)
        
    except Exception as e:
        logger.error(f"Error in backup_switch_http: {str(e)}", exc_info=True)
        return jsonify({
            'success': False,
            'message': 'Internal server error',
            'error_type': 'ServerError'
        }), 500

@app.route('/delete_backup', methods=['POST'])
@login_required
def delete_backup():
    data = request.get_json()
    if 'filepath' not in data:
        return jsonify({'success': False, 'message': 'File path missing'}), 400

    try:
        filepath = data['filepath']
        # Normalizza il percorso per sicurezza
        filepath = os.path.normpath(filepath)
        backup_dir = os.path.abspath(BACKUP_DIR)
        requested_path = os.path.abspath(os.path.join(backup_dir, filepath))
        
        # Verifica che il percorso sia dentro la directory dei backup
        if not requested_path.startswith(backup_dir + os.sep):
            return jsonify({'success': False, 'message': 'Invalid file path'}), 403
        
        if os.path.isfile(requested_path):
            os.remove(requested_path)
            logger.info(f"Deleted backup file: {requested_path}")
            return jsonify({'success': True, 'message': 'Backup deleted'})
        else:
            return jsonify({'success': False, 'message': 'File not found'}), 404
            
    except Exception as e:
        logger.error(f"Error deleting backup: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500
        
def backup_switch(params: dict) -> dict:
    """
    Performs network switch configuration backup using multiple connection methods and retrieval techniques.
    Automatically handles different device types and fails safely on errors.

    Args:
        params: Dictionary containing parameters:
            - index (int): Switch index in the devices list
            - scheduled (bool, optional): Flag for scheduled backup. Default False.
            - retry_count (int, optional): Number of retry attempts. Default 2.

    Returns:
        dict: Operation result containing:
            - success (bool): Operation status
            - message (str): Descriptive message
            - hostname (str): Switch hostname
            - ip (str): Switch IP address
            - filename (str, optional): Backup filename if successful
            - error_type (str, optional): Error type if failed
            - output (str, optional): Partial output if available

    Raises:
        ValueError: If input parameters are invalid
    """
    # Initial parameter validation
    if not isinstance(params, dict) or 'index' not in params:
        raise ValueError("Missing or invalid parameters")

    logger.debug(f"Starting backup with params: { {k:v for k,v in params.items() if k not in ['password', 'secret']} }")

    try:
        # Validate switch index
        index = params.get('index')
        switches_data = load_switches()
        
        if not isinstance(switches_data, list):
            error_msg = "Invalid switches data format"
            logger.error(error_msg)
            return {
                'success': False,
                'message': error_msg,
                'error_type': 'DataError'
            }

        if index < 0 or index >= len(switches_data):
            error_msg = f"Invalid switch index {index}"
            logger.error(error_msg)
            return {
                'success': False,
                'message': error_msg,
                'error_type': 'IndexError'
            }

        # Extract device information
        switch = switches_data[index]
        hostname = switch['hostname']
        ip = switch['ip']
        username = switch['username']
        password = decrypt_password(switch['password'])
        enable_password = decrypt_password(switch['enable_password'])
        device_type = switch.get('device_type', 'cisco_ios')
        custom_command = switch.get('backup_command')

        # Prepare connection parameters
        device = {
            'device_type': device_type,
            'host': ip,
            'username': username,
            'password': password,
            'secret': enable_password,
            'timeout': 150,
            'session_timeout': 150,
            'global_delay_factor': 3,
            'fast_cli': False,
            'allow_auto_change': True,
            'verbose': False
        }

        logger.info(f"[{hostname}] Starting backup procedure")

        # Prepare backup file
        switch_folder = os.path.join(BACKUP_DIR, secure_filename(hostname))
        os.makedirs(switch_folder, exist_ok=True)
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        backup_filename = f"{hostname}_config_{timestamp}.txt"
        backup_path = os.path.join(switch_folder, backup_filename)

        # Attempt interactive backup method
        try:
            with ConnectHandler(**device) as net_connect:
                logger.info(f"[{hostname}] Connected, starting interactive backup")
                
                # Configure session
                net_connect.enable()
                net_connect.write_channel('\n')
                time.sleep(1)
                
                # Disable pagination
                pagination_commands = [
                    'terminal length 0\n',
                    'terminal width 512\n',
                    #'set cli screen-length 0\n'
                ]
                
                for cmd in pagination_commands:
                    net_connect.write_channel(cmd)
                    time.sleep(2)
                
                # Retrieve configuration
                full_output = ""
                config_commands = ['show running-config\n']
                
                for cmd in config_commands:
                    logger.info(f"[{hostname}] Executing: {cmd.strip()}")
                    net_connect.write_channel(cmd)
                    
                    start_time = time.time()
                    while time.time() - start_time < 60:
                        time.sleep(3)
                        new_data = net_connect.read_channel()
                        if new_data:
                            full_output += new_data
                            if any(pattern in new_data for pattern in ['#', 'end', '--More--']):
                                if '--More--' in new_data:
                                    net_connect.write_channel(' ')
                                break

                # Validate output
                if len(full_output.splitlines()) < 20:
                    raise Exception("Insufficient configuration data")

                # Clean and save configuration
                clean_output = "\n".join(
                    line for line in full_output.splitlines() 
                    if not any(line.startswith(cmd) for cmd in ['show', 'terminal', 'enable', 'conf t', 'exit'])
                )
                
                with open(backup_path, 'w', encoding='utf-8') as f:
                    f.write(clean_output)

                logger.info(f"[{hostname}] Backup completed successfully")
                switches_data[index]['last_backup_status'] = 'success'
                switches_data[index]['last_backup_time'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                save_switches(switches_data)
                return {
                    'success': True,
                    'message': "Backup completed",
                    'hostname': hostname,
                    'ip': ip,
                    'filename': backup_filename
                }



        except Exception as e:
            switches_data[index]['last_backup_status'] = 'failed'
            switches_data[index]['last_backup_time'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            save_switches(switches_data)
            logger.warning(f"[{hostname}] Interactive method failed, trying simple method: {str(e)}")
            
            # Fallback to simple method
            try:
                with ConnectHandler(**device) as net_connect:
                    output = net_connect.send_command_timing(
                        custom_command or 'show running-config',
                        delay_factor=5,
                        max_loops=3000
                    )
                    
                    if not output or len(output.splitlines()) < 10:
                        raise Exception("Insufficient output")
                    
                    with open(backup_path, 'w', encoding='utf-8') as f:
                        f.write(output)

                    logger.info(f"[{hostname}] Backup completed with simple method")
                    return {
                        'success': True,
                        'message': "Backup completed with fallback method",
                        'hostname': hostname,
                        'ip': ip,
                        'filename': backup_filename
                    }

            except Exception as fallback_error:
                error_msg = f"All backup methods failed: {str(fallback_error)}"
                logger.error(f"[{hostname}] {error_msg}")
                return {
                    'success': False,
                    'message': error_msg,
                    'hostname': hostname,
                    'ip': ip,
                    'error_type': 'BackupError',
                    'output': output[:1000] if 'output' in locals() else None
                }

    except (NetMikoTimeoutException, NetMikoAuthenticationException) as e:
        error_msg = f"Connection error: {str(e)}"
        logger.error(f"[{hostname}] {error_msg}")
        return {
            'success': False,
            'message': error_msg,
            'hostname': hostname,
            'ip': ip,
            'error_type': type(e).__name__
        }

    except Exception as e:
        error_msg = f"Unexpected error: {str(e)}"
        logger.error(f"[{hostname}] {error_msg}")
        return {
            'success': False,
            'message': error_msg,
            'hostname': hostname if 'hostname' in locals() else 'unknown',
            'ip': ip if 'ip' in locals() else 'unknown',
            'error_type': 'UnexpectedError'
        }



@app.route('/backup_all_switches', methods=['POST'])
@login_required
def backup_all_switches():
    try:
        logger.info("Starting backup process for all devices")
        
        # Carica gli switch con controllo errori rinforzato
        try:
            switches_data = load_switches()
            if not isinstance(switches_data, list):
                error_msg = "Invalid switches data format"
                logger.error(error_msg)
                return jsonify({
                    'success': False,
                    'message': error_msg,
                    'count': 0,
                    'total': 0,
                    'results': []
                })
        except Exception as e:
            error_msg = f"Failed to load switches: {str(e)}"
            logger.error(error_msg)
            return jsonify({
                'success': False,
                'message': error_msg,
                'count': 0,
                'total': 0,
                'results': []
            })

        if not switches_data:
            logger.warning("No devices configured for backup")
            return jsonify({
                'success': False,
                'message': 'No devices configured',
                'count': 0,
                'total': 0,
                'results': []
            })

        results = []
        for i, switch in enumerate(switches_data, 1):
            progress_msg = f"Processing device {i}/{len(switches_data)}: {switch['hostname']}"
            logger.info(progress_msg)
            
            result = backup_switch({'index': i-1})
            results.append({
                'success': result.get('success', False),
                'hostname': switch['hostname'],
                'ip': switch['ip'],
                'message': result.get('message', ''),
                'filename': result.get('filename', '')
            })

        success_count = sum(1 for r in results if r['success'])
        completion_msg = f"Backup completed. Success: {success_count}/{len(switches_data)}"
        logger.info(completion_msg)
        
        return jsonify({
            'success': True,
            'count': success_count,
            'total': len(switches_data),
            'results': results
        })

    except Exception as e:
        error_msg = f"Unexpected error in backup_all_switches: {str(e)}"
        logger.error(error_msg, exc_info=True)
        return jsonify({
            'success': False,
            'message': error_msg,
            'count': 0,
            'total': 0,
            'results': []
        }), 500

@app.route('/get_switch_backups', methods=['POST'])
@login_required
def get_switch_backups():
    data = request.get_json()
    if 'index' not in data:
        return jsonify({'success': False, 'message': 'Indice mancante'})
    
    switches_data = load_switches()
    index = int(data['index'])
    
    if index < 0 or index >= len(switches_data):
        return jsonify({'success': False, 'message': 'Indice switch non valido'})
    
    switch = switches_data[index]
    hostname = switch['hostname']
    switch_folder = os.path.join(BACKUP_DIR, secure_filename(hostname))
    
    if not os.path.exists(switch_folder):
        return jsonify({'success': True, 'hostname': hostname, 'backups': []})
    
    backups = []
    for filename in sorted(os.listdir(switch_folder), reverse=True):
        if filename.endswith('.txt'):
            filepath = os.path.join(switch_folder, filename)
            backups.append({
                'filename': filename,
                'path': filepath
            })
    
    return jsonify({
        'success': True,
        'hostname': hostname,
        'backups': backups
    })

@app.route('/get_backup_content', methods=['POST'])
@login_required
def get_backup_content():
    # Validazione dell'input JSON
    if not request.is_json:
        return jsonify({'success': False, 'message': 'Request must be JSON'}), 400
    
    data = request.get_json()
    if 'filepath' not in data:
        return jsonify({'success': False, 'message': 'Missing file path'}), 400
    
    # Validazione del percorso file
    try:
        filepath = data['filepath']
        if not isinstance(filepath, str):
            raise ValueError("Filepath must be a string")
            
        # Normalizzazione del percorso per prevenire directory traversal
        filepath = os.path.normpath(filepath)
        backup_dir = os.path.abspath(BACKUP_DIR)
        requested_path = os.path.abspath(os.path.join(backup_dir, filepath))
        
        # Verifica che il percorso sia dentro la directory dei backup
        if not requested_path.startswith(backup_dir + os.sep):
            return jsonify({'success': False, 'message': 'Invalid file path'}), 403
        
        # Verifica esistenza file
        if not os.path.isfile(requested_path):
            return jsonify({'success': False, 'message': 'File not found'}), 404
        
        # Lettura e sanitizzazione del contenuto
        with open(requested_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Sanitizzazione del contenuto per prevenire XSS
        sanitized_content = escape(content)
        
        return jsonify({
            'success': True,
            'filename': os.path.basename(requested_path),
            'content': sanitized_content  # Contenuto sanitizzato
        })
        
    except UnicodeDecodeError:
        return jsonify({'success': False, 'message': 'Invalid file encoding (UTF-8 required)'}), 400
    except ValueError as e:
        return jsonify({'success': False, 'message': str(e)}), 400
    except Exception as e:
        logging.error(f"Error accessing backup file: {str(e)}", exc_info=True)
        return jsonify({'success': False, 'message': 'Internal server error'}), 500

# API per la gestione degli schedule
@app.route('/add_schedule', methods=['POST'])
@login_required
def add_schedule():
    data = request.get_json()
    if not all(key in data for key in ['type', 'time']):
        return jsonify({'success': False, 'message': 'Dati mancanti'})
    
    schedule_id = f"sch_{int(time.time())}_{len(load_schedules())}"
    data['id'] = schedule_id
    data['created_at'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    
    schedules_data = load_schedules()
    schedules_data.append(data)
    save_schedules(schedules_data)
    add_scheduled_job(data)
    
    logger.info(f"New schedule added: {get_schedule_description(data)}")
    return jsonify({
        'success': True,
        'message': 'Schedule added',
        'id': schedule_id
    })

@app.route('/get_schedules', methods=['GET'])
@login_required
def get_schedules():
    schedules_data = load_schedules()
    jobs = scheduler.get_jobs()
    
    for schedule in schedules_data:
        job = next((j for j in jobs if j.id == schedule['id']), None)
        if job:
            schedule['next_run'] = job.next_run_time.strftime('%Y-%m-%d %H:%M:%S') if job.next_run_time else "N/A"
            schedule['enabled'] = True
        else:
            schedule['next_run'] = "N/A"
            schedule['enabled'] = False
    
    return jsonify(schedules_data)

@app.route('/toggle_schedule', methods=['POST'])
@login_required
def toggle_schedule():
    data = request.get_json()
    if not all(key in data for key in ['id', 'enabled']):
        return jsonify({'success': False, 'message': 'Dati mancanti'})
    
    schedules_data = load_schedules()
    schedule = next((s for s in schedules_data if s['id'] == data['id']), None)
    
    if not schedule:
        return jsonify({'success': False, 'message': 'Pianificazione non trovata'})
    
    if data['enabled']:
        add_scheduled_job(schedule)
        schedule['enabled'] = True
        message = 'Pianificazione attivata'
    else:
        scheduler.remove_job(data['id'])
        schedule['enabled'] = False
        message = 'Pianificazione disattivata'
    
    save_schedules(schedules_data)
    logger.info(f"Pianificazione {data['id']} {'attivata' if data['enabled'] else 'disattivata'}")
    return jsonify({'success': True, 'message': message})

@app.route('/delete_schedule', methods=['POST'])
@login_required
def delete_schedule():
    data = request.get_json()
    if 'id' not in data:
        return jsonify({'success': False, 'message': 'ID mancante'})
    
    schedules_data = load_schedules()
    schedule = next((s for s in schedules_data if s['id'] == data['id']), None)
    
    if not schedule:
        return jsonify({'success': False, 'message': 'Pianificazione non trovata'})
    
    scheduler.remove_job(data['id'])
    schedules_data = [s for s in schedules_data if s['id'] != data['id']]
    save_schedules(schedules_data)
    
    logger.info(f"Eliminata pianificazione: {get_schedule_description(schedule)}")
    return jsonify({'success': True, 'message': 'Pianificazione eliminata'})

# API per la gestione dei log
@app.route('/log_event', methods=['POST'])
@login_required
def log_event():
    data = request.get_json()
    if 'message' in data:
        logger.info(data['message'])
    return jsonify({'success': True})

@app.route('/get_full_log', methods=['GET'])
@login_required
def get_full_log():
    try:
        log_content = ""
        if os.path.exists(EVENTS_LOG):
            with open(EVENTS_LOG, 'r') as f:
                # Filtra solo le righe che iniziano con timestamp e non contengono werkzeug
                log_content = "\n".join(
                    line for line in f.readlines() 
                    if line.strip() and not "werkzeug" in line
                )
        
        archived_logs = []
        if os.path.exists(LOG_DIR):
            for filename in sorted(os.listdir(LOG_DIR), reverse=True):
                if filename.startswith('events.') and filename.endswith('.log') and filename != 'events.log':
                    with open(os.path.join(LOG_DIR, filename), 'r') as f:
                        # Filtra anche i log archiviati
                        content = "\n".join(
                            line for line in f.readlines()
                            if line.strip() and not "werkzeug" in line
                        )
                        if content:
                            archived_logs.append(f"=== Log {filename} ===\n{content}\n")
        
        full_log = log_content + "\n".join(archived_logs)
        return jsonify({'success': True, 'log': escape(full_log)})
    except Exception as e:
        return jsonify({'success': False, 'message': str(e)})

# API per l'import/export CSV
@app.route('/upload_csv', methods=['POST'])
@login_required
def upload_csv():
    if 'csv_file' not in request.files:
        return jsonify({'success': False, 'message': 'No file provided'})
    
    csv_file = request.files['csv_file']
    if csv_file.filename == '':
        return jsonify({'success': False, 'message': 'No file selected'})
    
    if not csv_file.filename.endswith('.csv'):
        return jsonify({'success': False, 'message': 'File must be .csv'})
    
    try:
        stream = io.StringIO(csv_file.stream.read().decode('UTF-8'))
        csv_reader = csv.DictReader(stream)
        
        switches_data = load_switches()
        added = 0
        skipped = 0
        existing_ips = {sw['ip'] for sw in switches_data}
        
        for row in csv_reader:
            if not all(field in row for field in ['hostname', 'ip', 'username', 'password']):
                return jsonify({'success': False, 'message': 'CSV format not valid'})
            
            if row['ip'] in existing_ips:
                skipped += 1
                continue
            
            # Always set enable_password equal to password if not provided in CSV
            encrypted_password = encrypt_password(row['password'])
            encrypted_enable_password = encrypt_password(row.get('enable_password', row['password']))
            
            switches_data.append({
                'hostname': row['hostname'],
                'ip': row['ip'],
                'username': row['username'],
                'password': encrypted_password,
                'enable_password': encrypted_enable_password,
                'device_type': row.get('device_type', 'cisco_ios')
            })
            existing_ips.add(row['ip'])
            added += 1
        
        if added > 0:
            save_switches(switches_data)
            logger.info(f"Loaded {added} devices from CSV, {skipped} already present")
        
        return jsonify({
            'success': True,
            'message': 'CSV loaded successfully',
            'added': added,
            'skipped': skipped
        })
    except Exception as e:
        logger.error(f"Error while loading CSV: {str(e)}")
        return jsonify({'success': False, 'message': str(e)})
        
@app.route('/export_switches_csv', methods=['GET'])
@login_required
def export_switches_csv():
    try:
        switches_data = load_switches()
        output = io.StringIO()
        writer = csv.writer(output)
        writer.writerow(['hostname', 'ip', 'username'])
        
        for switch in switches_data:
            writer.writerow([switch['hostname'], switch['ip'], switch['username']])
        
        output.seek(0)
        mem_file = io.BytesIO()
        mem_file.write(output.getvalue().encode('utf-8'))
        mem_file.seek(0)
        
        logger.info(f"Exported {len(switches_data)} devices in CSV")
        return send_file(
            mem_file,
            mimetype='text/csv',
            as_attachment=True,
            download_name=f'switches_backup_{datetime.now().strftime("%Y%m%d")}.csv'
        )
    except Exception as e:
        logger.error(f"Error during the export of CSV: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500





# HTML Template (rimasto invariato)
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PICKLED – Because broken routers don’t explain themselves</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <link rel="icon" type="image/png" href="data:image/png;base64,{{ favicon }}">
    <style>
        :root {
            --primary-light: #0f5350;
            --primary-main: #2d8371;
            --primary-dark: #aacf76;
            --petrol: #02433e;
            --petrol-dark: #01201e;
            --petrol-light: #0d4d49;
            --accent-color: #ff8a65;
            --light-color: #f1f8e9;
            --dark-color: #263238;
            --gray-light: #e8f5e9;
            --gray-medium: #c8e6c9;
            --gray-dark: #2e7d32;
            --bg-gradient-start: #e6f3e0;
            --bg-gradient-end: #d0e6c5;
        }
        body {
            background: linear-gradient(135deg, 
                      var(--bg-gradient-start) 0%, 
                      var(--bg-gradient-end) 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
	/* Stile per la cella dell'header */
	.switch-table th:nth-child(4) {
	    position: relative;  /* Contesto per posizionamento assoluto */
	    padding-right: 120px;  /* Spazio per il selettore */
	}

	/* Stile per il contenitore del selettore */
	.per-page-selector {
	    position: absolute;
	    right: 10px;  
	    top: 50%;
	    transform: translateY(-50%);
	}

	/* Stile per il select */
	.per-page-selector select {
	    padding: 3px;
	    border-radius: 3px;
	    border: 1px solid #ddd;
	    background-color: white;
	    font-size: 12px;
	    width: auto;  /* Larghezza automatica in base al contenuto */
	}

     .log {
         margin-top: 30px;
         max-height: 300px;
         overflow-y: auto;
         background-color: #1a1a1a;
         color: #e0e0e0;
         padding: 15px;
         border-radius: 4px;
         font-family: monospace;
         white-space: pre-wrap;
         font-size: 14px;
         line-height: 1.5;
     }
     .log div {
         margin-bottom: 5px;
         padding: 3px 5px;
         border-radius: 3px;
     }
     .log div:hover {
         background-color: #2a2a2a;
     }
        .app-container {
            display: flex;
            min-height: calc(100vh - 40px);
            gap: 20px;
        }
	/* Tooltip */
	.copy-tooltip {
	    position: relative;
	    display: block;
	    cursor: pointer;
	    margin-top: 20px; /* Spazio per il tooltip */
	}

	    .copy-tooltip .tooltiptext {
		visibility: hidden;
		width: 140px;
		background-color: #333;
		color: #fff;
		text-align: center;
		border-radius: 4px;
		padding: 5px;
		position: absolute;
		z-index: 1001;  
		bottom: calc(100% - 10px);  
		left: 50%;
		transform: translateX(-50%);
		opacity: 0;
		transition: opacity 0.3s;
		font-size: 13px;
		font-family: Arial, sans-serif;
		pointer-events: none;
	    }

	.copy-tooltip:hover .tooltiptext {
	    visibility: visible;
	    opacity: 1;
	}

	.copy-tooltip.copied .tooltiptext {
	    background-color: #4CAF50;
	}

	.config-content {
	    font-family: monospace;
	    white-space: pre;
	    background-color: #f8f8f8;
	    padding: 15px;
	    border-radius: 4px;
	    max-height: 70vh;
	    overflow-y: auto;
	    margin: 0;
	    border: 1px solid #ddd;
	    position: relative;
	}
        .left-panel {
            width: 300px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--gray-medium);
        }
        .left-panel > button {
            width: calc(100% - 24px);
            padding: 12px;
            margin-top: 5px;
        }
        /* Colonna centrale - Tabella switch */
	.center-panel {
	    flex: 1;
	    background-color: white;
	    padding: 20px;
	    border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--gray-medium);
            display: flex;
            flex-direction: column;
	    margin: 0 20px; /* Aggiunge spazio tra le colonne */
        position: relative;
	}
    
    /* Sfondo per la tabella Device List */
    .device-list-background {
        position: absolute;
        top: 10%;
        left: 10%;
        width: 80%;
        height: 80%;
        background-image: url("data:image/png;base64,{{ pickledlogo }}");
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.12;
        z-index: 0;
        pointer-events: none;
    }
    
        /* Colonna destra - Scheduler e log */
	.right-panel {
	    width: 350px;
	    background-color: white;
	    padding: 15px;
	    border-radius: 8px;
	    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	    display: flex;
	    flex-direction: column;
	}
        /* Tabella switch con scroll */
	.switch-table-container {
	    flex: 1;
	    overflow-y: auto;
	    margin-top: 10px;
	}
        /* Barra di ricerca */
        .search-container {
            display: flex;
            margin-bottom: 15px;
        }
        .search-container input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-medium);
            border-radius: 4px;
        }      
        /* Paginazione */
	.pagination {
	    display: flex;
	    justify-content: center;
	    align-items: center;
	    margin-top: 15px;
	    gap: 5px;
	    flex-wrap: wrap;
	}
        h1, h2, h3 {
            color: var(--petrol);
        }
	.pagination button {
	    padding: 5px 10px;
	    background-color: var(--gray-light);
	    color: var(--dark-color);
	    border: 1px solid var(--gray-medium);
	    border-radius: 4px;
	    cursor: pointer;
	    min-width: 32px;
	    transition: all 0.2s;
	}
	.pagination button:hover:not(:disabled) {
	    background-color: var(--petrol-dark);
	    color: white;
	    border-color: var(--petrol-light);
	}
	.pagination button.active {
	    background-color: var(--petrol-dark);
	    color: white;
	    border-color: var(--petrol-light);
	}
	.pagination button:disabled {
	    opacity: 0.5;
	    cursor: not-allowed;
	}

	.pagination button i {
	    font-size: 14px;
	}
        h1 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: var(--dark-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
            margin-top: 0;
        }
        .form-group input {
            width: calc(100% - 24px);
            padding: 10px 12px;
            border: 1px solid var(--gray-medium);
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--petrol)
            font-size: 13px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-medium);
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s;
        }
        button {
            background-color: var(--petrol);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--primary-main);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .status-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        .status {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .success {
            background-color: #c8e6c9;
            color: #2e7d32;
            border-left: 4px solid var(--primary-main);
        }
        .error {
            background-color: #ffcdd2;
            color: #c62828;
            border-left: 4px solid #ef5350;
        }
        .log {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            background-color: var(--dark-color);
            color: #e0e0e0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }
        /* Log attività ridimensionato */
        .log-panel {
            flex: 1;
            overflow-y: auto;
            margin-top: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
        }
	.switch-table {
	    width: 100%;
	    border-collapse: separate;  /* Cambiato da collapse a separate */
	    border-spacing: 0;
	    margin-top: 20px;
	    border-radius: 8px;  /* Aggiunto per smussare gli angoli */
	    overflow: hidden;  /* Per mantenere i bordi arrotondati */
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
	}
        .switch-table th, .switch-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-medium);
        }
        .switch-table th {
            background-color: var(--petrol)
            color: white;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
        }
        .switch-table th:hover {
            background-color: var(--primary-hover);
        }
        .switch-table tr {
            line-height: 1.3;
        }
        .switch-table tr:hover {
            background-color: var(--gray-light);
        }
	.search-header-container {
	    margin-bottom: 5px; /* Riduci da 15px a 10px */
	}
	.search-button {
	    padding: 4px 8px;
	    height: 30px; /* Altezza fissa */
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    gap: 5px;
	    border-radius: 4px;
	    font-size: 13px;
	    cursor: pointer;
	    transition: all 0.2s;
	    white-space: nowrap;
	}
        .search-button i {
            font-size: 12px;  /* Ridotto da 13px */
        }
	.search-buttons {
	    padding: 8px 12px;
	    min-width: 100px;  /* Larghezza minima per uniformità */
	    height: 36px;      /* Altezza fissa */
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    gap: 5px;
	}
	.search-buttons-container {
	    display: flex;
	    gap: 8px; /* Riduci lo spazio tra i pulsanti */
	    align-items: center;
	}
        .action-btn {
            padding: 6px 10px;
            margin: 0 2px;
            font-size: 14px;
            min-width: 30px;
            transition: all 0.2s ease;
        }
        .action-btn:hover {
  	    transform: translateY(-1px);
     	    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
	}
	.search-buttons:hover {
	    opacity: 0.9;
	    transform: translateY(-1px);
	}
        .edit-btn {
            background-color: #ffb74d;
        }

        .edit-btn:hover {
            background-color: #ffa726;
        }

        .delete-btn {
            background-color: #e57373;
        }

        .delete-btn:hover {
            background-color: #ef5350;
        }
        .backup-btn {
            background-color: var(--primary-main);
        }

        .backup-btn:hover {
            background-color: var(--primary-dark);
        }

        .view-btn {
            background-color: #7986cb;
        }

        .view-btn:hover {
            background-color: #5c6bc0;
        }
        .backup-all-btn {
            background-color: var(--purple-color);
            margin-top: 20px;
            width: 100%;
        }
        .backup-all-btn:hover {
            background-color: var(--purple-hover);
        }

	.exp-btn {
	    background-color: #2c3e50;
	    color: white;
	}

	.backup-btn {
	    background-color: #2ecc71;
	    color: white;
	}

	.search-button:hover {
	    opacity: 0.9;
	    transform: translateY(-1px);
	}
        .backup-exp-btn {
            background-color: var(--blue-color);
            margin-top: 20px;
            width: 100%;
        }
        .backup-exp-btn:jover {
            background-color: var(--blue-hover);
        }
        .csv-btn {
            background-color: var(--dark-color);
            margin-top: 10px;
            width: 100%;
        }
        .csv-btn:hover {
            background-color: #680cec;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: auto;
	    transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid var(--primary-main);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
        }
        .close-btn {
            font-size: 1.5em;
            cursor: pointer;
        }
	.modal-body {
	    display: flex;
	    min-height: 0;
	    flex: 1; 
	    gap: 15px;
	    padding: 10px;
	    min-height: 0; 
            overflow: auto;  /* Aggiunto */
	}
	.config-container {
	    flex: 1;
	    display: flex;
	    flex-direction: column;
	    min-height: 0;
	    position: relative;
	    overflow: auto;
	    padding-right: 15px;
	}
	.backup-list {
	    width: 20%;
	    overflow-y: auto;
	    min-width: 300px; /* Larghezza minima */
	    max-height: 100%;
	}

	.backup-content {
	    width: 70%;
	    display: flex;
	    flex-direction: column;
	    min-height: 0
	    overflow: auto;
	}
	/* Placeholder */
	#backup-content-placeholder {
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	    justify-content: center;
	    height: 100%;
	    color: #777;
	}
	#backup-content {
 	   background: #f8f8f8;
   	   border-radius: 4px;
	   padding: 12px;
	}
        .backup-item {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            color: --petrol-light;
        }
     
        .backup-item:hover {
            background-color: var(--gray-light);
        }
        .backup-item.active {
            background-color: var(--primary-dark);
            color: --petrol-dark;
        }
        .config-content {
	    font-family: monospace;
	    white-space: pre;
	    background-color: #f8f8f8;
	    padding: 15px;
	    border-radius: 4px;
	    overflow-y: auto;
	    flex: 1;
	    border: 1px solid #ddd;
	    margin: 0;
	    max-height: 100%;
        }
        .split-view {
            display: flex;
            width: 100%;
        }
        .form-column {
            flex: 1;
            padding: 0 10px;
        }
        .log-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
        }
	.log-content {
	    font-family: monospace;
	    white-space: pre-wrap;
	    background-color: #f8f8f8;
	    padding: 15px;
	    border-radius: 4px;
	    max-height: 60vh; /* Aumenta l'altezza massima */
	    overflow-y: auto;
	    width: calc(100% + 20px); /* Compensa i margini negativi */
	}
	.log-line {
	    margin: 0;
	    padding: 2px 5px;
	    border-radius: 2px;
	    transition: background-color 0.2s;
	}

	.log-line:hover {
	    background-color:  #e7f585; 
	    cursor: default;
	}
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .file-input-container {
            margin-top: 15px;
        }
        .file-input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .file-input {
            width: calc(100% - 24px);
            padding: 8px 12px;
        }

	.backup-status {
	    display: inline-block;
	    margin-right: 5px;
	    cursor: help;
	}

	.backup-status i {
	    font-size: 10px;
	    vertical-align: middle;
	}
	.backup-status:hover i {
	    transform: scale(1.3);
	}
        .schedule-form {
            background-color: var(--gray-light);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .schedule-form h3 {
            margin-top: 0;
            color: var(--dark-color);
            border-bottom: 1px solid var(--gray-medium);
            padding-bottom: 8px;
        }
        .schedule-option {
            display: none;
            margin-top: 10px;
        }
        .schedule-option.active {
            display: block;
        }
        .schedule-list {
            margin-top: 15px;
        }
        .schedule-item {
            padding: 10px;
            background-color: white;
            border: 1px solid var(--gray-medium);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .schedule-item-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }
        .schedule-item-actions {
            display: flex;
            gap: 5px;
        }
        .schedule-item-actions button {
            padding: 2px 6px;
            font-size: 12px;
        }
        .select2-container {
            width: 100% !important;
            margin-bottom: 15px;
        }
	#search-input {
	    height: 30px;
	    padding: 5px 30px 5px 10px;
	    border: 1px solid #ddd;
	    border-radius: 4px;
	    margin-right: 10px;
	    transition: all 0.3s ease;
	    width: 180px; /* Larghezza iniziale */
	}

	#search-input:focus {
	    width: 250px;
	    border-color: var(--primary-color);
	    outline: none;
	    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
	}
        /* Riduci dimensioni icona di ricerca */
        #search-input + .fa-search {
            font-size: 12px;  /* Ridotto da 14px */
            right: 8px;  /* Aggiustato posizione */
            top: 9px;  /* Aggiustato posizione */
        }
        input:not([type="file"]):not([type="checkbox"]):not([type="radio"]),
        select {
            height: 32px;  /* Ridotto da altezza precedente */
            padding: 5px 10px;  /* Ridotto da 8px 12px */
            font-size: 14px;  /* Ridotto da 16px */
        }   
        footer {
            font-size: 12px;
            color: var(--petrol);
            text-align: center;
            margin-top: 20px;
            opacity: 0.8;
        }   
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-main);
            border-radius: 4px;
        }
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .app-container {
                flex-direction: column;
            }
            
            .left-panel, .center-panel, .right-panel {
                width: auto;
            }
        }  
    </style>
</head>
<body>
    <div class="status-container">
        <div id="status-message" class="status"></div>
    </div>
    <div class="app-container">
        <!-- Pannello sinistro - Form aggiunta switch -->
        <div class="left-panel">
            <h2>Add device</h2>
            <div class="form-group">
                <label for="hostname">Hostname:</label>
                <input type="text" id="hostname" placeholder="Es: Switch1">
            </div>
            <div class="form-group">
                <label for="ip">IP Address:</label>
                <input type="text" id="ip" placeholder="Es: 192.168.1.1">
            </div>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Username SSH">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Password SSH">
            </div>
    	    <div class="form-group">
	        <label for="enable-password">Enable Password (optional):</label>
	        <input type="password" id="enable-password" placeholder="Enable/Secret password">
	    </div>
	   
            <div class="form-group">
	    <label for="device-type">Tipo dispositivo:</label>
	    <select id="device-type" class="form-control">
		<option value="cisco_ios">Cisco IOS</option>
		<option value="cisco_xe">Cisco IOS-XE</option>
		<option value="cisco_xr">Cisco IOS-XR</option>
		<option value="huawei">Huawei</option>
		<option value="juniper">Juniper JunOS</option>
	    </select> 
	    </div>

            <button onclick="addSwitch()">Add Device</button>

            
            <h2 style="margin-top: 30px;">Load CSV</h2>
            <div class="file-input-container">
                <label class="file-input-label" for="csv-file">Select CSV file:</label>
                <input type="file" id="csv-file" class="file-input" accept=".csv">
            </div>
            <button class="csv-btn" onclick="uploadCSV()">
                <i class="fas fa-file-import"></i> Load CSV
            </button>

	</div>


	    <!-- Colonna centrale - Tabella switch -->
	    <div class="center-panel">
        
        <!-- Placeholder per sfondo tabella centrale -->
        <div class="device-list-background"></div>
		
        <!-- Header con titolo, ricerca e pulsanti -->
		<div class="search-header-container">
		    <div style="display: flex; justify-content: space-between; align-items: center;">
			<h2 style="margin: 0;">Device List</h2>
			<div class="search-buttons-container">
			    <div style="position: relative;">
			    <input type="text" id="search-input" placeholder="Search devices..." 
				   style="padding: 5px 30px 5px 10px; border: 1px solid #ddd; border-radius: 4px; height: 30px; margin-right: 10px;"
				   oninput="filterSwitches()">
   				 <i class="fas fa-search" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #777;"></i>
			    </div>
			    <button class="search-button exp-btn" onclick="exportSwitchesToCSV()">
				<i class="fas fa-file-export"></i> Export
			    </button>
			    <button class="search-button backup-btn" onclick="backupAllSwitches()">
				<i class="fas fa-download"></i> Backup
			    </button>
			    <button class="search-button" onclick="window.location.href='/logout'" style="background-color: #e74c3c;">
				<i class="fas fa-sign-out-alt"></i> Logout
			    </button>
			</div>
		    </div>
		</div>
		
		<!-- Tabella con scroll -->
		<div class="switch-table-container">
		    <table class="switch-table">
			    <thead>
				<tr>
				    <th onclick="sortTable(0)">Hostname <i class="fas fa-sort"></i></th>
				    <th onclick="sortTable(1)">IP <i class="fas fa-sort"></i></th>
				    <th onclick="sortTable(2)">Username <i class="fas fa-sort"></i></th>
					<th>Actions
					    <span class="per-page-selector">
						<select id="items-per-page" onchange="changeItemsPerPage()">
						    <option value="5">5</option>
						    <option value="10">10</option>
						    <option value="15" selected>15</option>
						    <option value="20">20</option>
						    <option value="50">50</option>
						    <option value="100">100</option>
						</select>
					    </span>
					</th>

				</tr>
			    </thead>
		        <tbody id="switches-table-body">
		            <!-- Le righe della tabella verranno aggiunte qui dinamicamente -->
		        </tbody>
		    </table>
		</div>
		
		<!-- Paginazione -->
		<div class="pagination" id="pagination">
		    <!-- Popolato dinamicamente da JavaScript -->
		</div>
	    </div>

        <!-- Colonna destra - Scheduler e log -->
        <div class="right-panel">

                <h2>Backup Scheduler</h2>
                
                <div class="schedule-form">
                    <h3>New Schedule</h3>
                    
                    <div class="form-group">
                        <label for="schedule-type">Type:</label>
                        <select id="schedule-type" class="form-control" onchange="showScheduleOptions()">
                            <!--<option value="once">One Time</option>-->
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="schedule-time">Hour:</label>
                        <input type="time" id="schedule-time" class="form-control" value="00:00">
                    </div>
                    
                    <!-- Opzioni specifiche per tipo -->
                    <div id="once-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-date">Data:</label>
                            <input type="date" id="schedule-date" class="form-control">
                        </div>
                    </div>
                    
                    <div id="weekly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-day-week">Giorno settimana:</label>
                            <select id="schedule-day-week" class="form-control">
                                <option value="0">Monday</option>
                                <option value="1">Tuesday</option>
                                <option value="2">Wednesday</option>
                                <option value="3">Thursday</option>
                                <option value="4">Friday</option>
                                <option value="5">Saturday</option>
                                <option value="6">Sunday</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="monthly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-day-month">Day month:</label>
                            <input type="number" id="schedule-day-month" min="1" max="31" value="1" class="form-control">
                        </div>
                    </div>
                    
                    <div id="yearly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-month">Month:</label>
                            <select id="schedule-month" class="form-control">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="schedule-day-year">Day:</label>
                            <input type="number" id="schedule-day-year" min="1" max="31" value="1" class="form-control">
                        </div>
                    </div>
                    
                    <button onclick="addSchedule()" class="backup-btn">
                        <i class="fas fa-calendar-plus"></i> Add Schedule
                    </button>
                </div>
                
                <div class="schedule-list" id="schedules-list">
                    <!-- Lista delle pianificazioni verrà popolata dinamicamente -->
                </div>


            <div id="status-message" class="status"></div>

            <h2 style="margin-top: 30px;">Activity Log</h2>
            <div id="log" class="log">Ready to backup...</div>
            <button onclick="viewFullLog()" style="margin-top: 10px; width: 100%;">
                <i class="fas fa-scroll"></i> Show log
            </button>
        </div>
    </div>

	<div id="backup-modal" class="modal">
	    <div class="modal-content" style="width: 90%; max-width: 1400px; height: 85vh;">
		<div class="modal-header">
		    <div class="modal-title">Available backup by <span id="modal-switch-name"></span></div>
		    <span class="close-btn" onclick="closeModal()">&times;</span>
		</div>
		<div class="modal-body" style="height: calc(100% - 60px);">
		    <!-- Lista backup più stretta (25%) -->
		    <div class="backup-list" id="backup-list" style="width: 25%; min-width: 220px; border-right: 1px solid #eee; padding-right: 15px;">
		        <!-- Lista dei backup -->
		    </div>
		    
		    <!-- Contenuto principale più ampio (75%) -->
		    <div class="backup-content" style="width: 75%;">
		        <div id="backup-content-placeholder">
		            <i class="fas fa-arrow-left" style="font-size: 24px; color: #ccc; margin-bottom: 10px;"></i>
		            <p>Select a backup from the list to view content</p>
		        </div>
		        
		        <div id="backup-content" style="display: none; flex-direction: column; height: 100%;">
		            <!-- Barra dei bottoni compatta -->
		            <div style="display: flex; justify-content: flex-end; gap: 8px; padding: 8px 0; margin-bottom: 12px;">
		                <button class="action-btn delete-btn" id="delete-backup-btn" style="padding: 5px 12px; font-size: 13px;">
		                    <i class="fas fa-trash"></i> Delete
		                </button>
		                <button class="action-btn backup-btn" id="export-backup-btn" style="padding: 5px 12px; font-size: 13px;">
		                    <i class="fas fa-download"></i> Export
		                </button>
		            </div>
		            
		            <!-- Contenuto configurazione -->
		            <div class="config-container" style="flex: 1; overflow-y: auto; background: #f8f8f8; border-radius: 4px; padding: 15px;">
		                <div class="copy-tooltip" onclick="copyToClipboard(this)" style="position: relative;">
		                    <span class="tooltiptext">Copy to clipboard</span>
		                    <pre class="config-content" style="white-space: pre-wrap; margin: 0; font-family: 'Courier New', monospace; font-size: 13px;"></pre>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
	    </div>
	</div>

	<!-- Modal per modificare switch -->
	<div id="edit-modal" class="modal">
	    <div class="modal-content" style="max-width: 600px;">
		<div class="modal-header">
		    <div class="modal-title">Modify Device</div>
		    <span class="close-btn" onclick="closeEditModal()">&times;</span>
		</div>
		<div class="modal-body">
		    <div class="split-view">
		        <div class="form-column">
		            <div class="form-group">
		                <label for="edit-hostname">Hostname:</label>
		                <input type="text" id="edit-hostname">
		            </div>
		            <div class="form-group">
		                <label for="edit-ip">IP Address:</label>
		                <input type="text" id="edit-ip">
		            </div>
		        </div>
		        <div class="form-column">
		            <div class="form-group">
		                <label for="edit-username">Username:</label>
		                <input type="text" id="edit-username">
		            </div>
		            <div class="form-group">
		                <label for="edit-password">Password:</label>
		                <input type="password" id="edit-password" placeholder="Leave blank to keep current">
		            </div>
		            <div class="form-group">
		                <label for="edit-enable-password">Enable Password:</label>
		                <input type="password" id="edit-enable-password" placeholder="Leave blank to keep current">
		            </div>
		        </div>
		    </div>
		</div>
		<div style="text-align: right; margin-top: 20px;">
		    <button onclick="closeEditModal()">Cancel</button>
		    <button class="backup-btn" onclick="saveEditedSwitch()" style="margin-left: 10px;">Save changes</button>
		</div>
		<input type="hidden" id="edit-index">
	    </div>
	</div>

    <!-- Modal per visualizzare il log completo -->
    <div id="log-modal" class="modal">
        <div class="log-modal-content">
            <div class="modal-header">
                <div class="modal-title">Complete log activity</div>
                <span class="close-btn" onclick="closeLogModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="full-log-content" class="log-content"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeLogModal()">Close</button>
            </div>
        </div>
    </div>

		<footer>
		    PICKLED v{{ version }} | Network Configuration Manager
		</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        let switchesPerPage = 15;
        let currentSortColumn = -1;
        let sortDirection = 1;
        let currentPage = 1;
        let allSwitches = [];
        let filteredSwitches = [];

	window.eval = function() {
	    throw new Error("eval() is disabled for security reasons");
	};
	// Funzione di utilità per escape HTML
	function escapeHtml(unsafe) {
	    return unsafe
		.replace(/&/g, "&amp;")
		.replace(/</g, "&lt;")
		.replace(/>/g, "&gt;")
		.replace(/"/g, "&quot;")
		.replace(/'/g, "&#039;");
	}
        function changeItemsPerPage() {
            const select = document.getElementById('items-per-page');
            switchesPerPage = parseInt(select.value);
            currentPage = 1; // Resetta alla prima pagina quando cambi il numero di elementi
            renderSwitches();
            updatePagination();
        }

	function safeInsert(text) {
	    return text.replace(/&/g, '&amp;')
		       .replace(/</g, '&lt;')
		       .replace(/>/g, '&gt;')
		       .replace(/"/g, '&quot;')
		       .replace(/'/g, '&#39;');
	}

	function filterSwitches() {
	    const searchTerm = document.getElementById('search-input').value.toLowerCase();
	    
	    if (searchTerm.trim() === '') {
		filteredSwitches = [...allSwitches];
	    } else {
		filteredSwitches = allSwitches.filter(sw => 
		    sw.hostname.toLowerCase().includes(searchTerm) || 
		    sw.ip.toLowerCase().includes(searchTerm) ||
		    (sw.username && sw.username.toLowerCase().includes(searchTerm))
		);
	    }
	    
	    currentPage = 1; // Resetta alla prima pagina quando filtri
	    renderSwitches();
	    updatePagination();
	}
        

	function renderSwitches() {
	    const tbody = document.getElementById('switches-table-body');
	    tbody.innerHTML = '';

	    if (filteredSwitches.length === 0) {
		tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No matching devices found</td></tr>';
		return;
	    }

	    const startIndex = (currentPage - 1) * switchesPerPage;
	    const endIndex = Math.min(startIndex + switchesPerPage, filteredSwitches.length);
	    const switchesToShow = filteredSwitches.slice(startIndex, endIndex);

	    switchesToShow.forEach((sw, i) => {
		const row = document.createElement('tr');
		row.innerHTML = `
		    <td>
		        <span class="backup-status" id="status-${sw.originalIndex}" title="${getStatusTooltip(sw)}">
		            <i class="fas fa-circle" style="color: ${getStatusColor(sw)}; font-size: 10px; margin-right: 5px;"></i>
		        </span>
		        ${highlightMatches(sw.hostname)}
		    </td>
		    <td>${highlightMatches(sw.ip)}</td>
		    <td>${highlightMatches(sw.username)}</td>
		    <td>
		        <button class="action-btn backup-btn" title="Backup" onclick="backupSwitch(${sw.originalIndex})">
		            <i class="fas fa-download"></i>
		        </button>
		        <button class="action-btn edit-btn" title="Modifica" onclick="openEditModal(${sw.originalIndex})">
		            <i class="fas fa-edit"></i>
		        </button>
		        <button class="action-btn view-btn" title="Visualizza Backup" onclick="viewBackups(${sw.originalIndex})">
		            <i class="fas fa-eye"></i>
		        </button>
		        <button class="action-btn delete-btn" title="Elimina" onclick="deleteSwitch(${sw.originalIndex})">
		            <i class="fas fa-trash"></i>
		        </button>
		    </td>
		`;
		tbody.appendChild(row);
	    });
	}

	function getStatusColor(switchData) {
	    if (!switchData.last_backup_status) return 'gray';  // Mai eseguito
	    if (switchData.last_backup_status === 'success') return 'green';
	    if (switchData.last_backup_status === 'failed') return 'red';
	    return 'gray';
	}

	function getStatusTooltip(switchData) {
	    if (!switchData.last_backup_status) return 'Backup never attempted';
	    if (switchData.last_backup_status === 'success') 
		return `Last successful backup: ${switchData.last_backup_time}`;
	    if (switchData.last_backup_status === 'failed') 
		return `Last backup failed: ${switchData.last_backup_time}`;
	    return 'Unknown status';
	}


	
	function highlightMatches(text) {
	    if (!text) return ''; // Aggiunto controllo per valori null/undefined
	    const searchTerm = document.getElementById('search-input').value.toLowerCase();
	    if (!searchTerm || !text) return text;
	    
	    const str = text.toString();
	    const lowerStr = str.toLowerCase();
	    const termLower = searchTerm.toLowerCase();
	    
	    let result = '';
	    let lastIndex = 0;
	    let index = lowerStr.indexOf(termLower);
	    
	    while (index >= 0) {
		result += str.substring(lastIndex, index) + 
		         '<span style="background-color: yellow;">' + 
		         str.substring(index, index + searchTerm.length) + 
		         '</span>';
		lastIndex = index + searchTerm.length;
		index = lowerStr.indexOf(termLower, lastIndex);
	    }
	    
	    result += str.substring(lastIndex);
	    return result;
	}
        
function updatePagination() {
    const pageCount = Math.ceil(filteredSwitches.length / switchesPerPage);
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    // Aggiorna la selezione nel menu a tendina
    document.getElementById('items-per-page').value = switchesPerPage;
    
    // Funzione per pulire tutti gli stati attivi
    const clearActiveStates = () => {
        document.querySelectorAll('#pagination button').forEach(b => {
            b.classList.remove('active');
            b.disabled = false;
        });
    };

    // Pulsante "Indietro"
    const prevBtn = document.createElement('button');
    prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
        if (currentPage > 1) {
            clearActiveStates();
            currentPage--;
            renderSwitches();
            updatePagination();
        }
    };
    paginationDiv.appendChild(prevBtn);

    // Pulsanti numerici
    for (let i = 1; i <= pageCount; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.onclick = () => {
            clearActiveStates();
            currentPage = i;
            btn.classList.add('active');
            btn.disabled = true;
            renderSwitches();
        };

        if (i === currentPage) {
            btn.classList.add('active');
            btn.disabled = true;
        }

        paginationDiv.appendChild(btn);
    }

    // Pulsante "Avanti"
    const nextBtn = document.createElement('button');
    nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
    nextBtn.disabled = currentPage >= pageCount;
    nextBtn.onclick = () => {
        if (currentPage < pageCount) {
            clearActiveStates();
            currentPage++;
            renderSwitches();
            updatePagination();
        }
    };
    paginationDiv.appendChild(nextBtn);

    if (pageCount === 0) {
        paginationDiv.innerHTML = '<span>No devices found</span>';
    }
}
	function addSwitch() {
	    const hostname = document.getElementById('hostname').value;
	    const ip = document.getElementById('ip').value;
	    const username = document.getElementById('username').value;
	    const password = document.getElementById('password').value;
	    const enablePassword = document.getElementById('enable-password').value;
	    const deviceType = document.getElementById('device-type').value;

	    if (!hostname || !ip || !username || !password) {
		showStatus('Please fill all required fields', 'error');
		return;
	    }

	    const switchData = { 
		hostname, 
		ip, 
		username, 
		password,
		device_type: deviceType
	    };
	    
	    if (enablePassword) {
		switchData.enable_password = enablePassword;
	    }
            
            fetch('/add_switch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify(switchData),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateSwitchTable();
                    document.getElementById('hostname').value = '';
                    document.getElementById('ip').value = '';
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    showStatus('Switch aggiunto con successo', 'success');
                    addToLog(`Device ${hostname} (${ip}) added to the list`);
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showStatus('Connection error: ' + error, 'error');
            });
        }

        function uploadCSV() {
            const fileInput = document.getElementById('csv-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Select a CSV file to load', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('csv_file', file);
            
            fetch('/upload_csv', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    showStatus(`Loaded ${data.added} devices from CSV (${data.skipped} already in the list)`, 'success');
                    addToLog(`Loaded ${data.added} devices from CSV file`);
                    updateSwitchTable();
                    fileInput.value = '';
                } else {
                    showStatus('Error: ' + data.message, 'error');
                    addToLog(`CSV load failed: ${data.message}`);
                }
            })
            .catch(error => {
                showStatus('Error: ' + error.message, 'error');
                addToLog(`Error during CSV load: ${error.message}`);
            });
        }

	function sortTable(columnIndex) {
	    if (currentSortColumn === columnIndex) {
		sortDirection *= -1;
	    } else {
		currentSortColumn = columnIndex;
		sortDirection = 1;
	    }
	    
	    // Ordina filteredSwitches invece di fare una nuova richiesta
	    filteredSwitches.sort((a, b) => {
		const keys = ['hostname', 'ip', 'username'];
		const key = keys[columnIndex];
		const valA = a[key]?.toLowerCase() || '';
		const valB = b[key]?.toLowerCase() || '';
		
		if (valA < valB) return -1 * sortDirection;
		if (valA > valB) return 1 * sortDirection;
		return 0;
	    });
	    
	    currentPage = 1; // Resetta alla prima pagina quando si ordina
	    renderSwitches();
	    updatePagination();
	    updateSortIcons();
	}

	function updateSwitchTable() {
	    fetch('/get_switches')
	    .then(response => response.json())
	    .then(switchesData => {
		allSwitches = switchesData.map((sw, index) => ({...sw, originalIndex: index}));
		filteredSwitches = [...allSwitches]; // Inizializza con tutti gli switch
		
		renderSwitches();
		updatePagination();
		updateSortIcons();
	    })
	    .catch(error => {
		console.error('Device load failed:', error);
		const tbody = document.getElementById('switches-table-body');
		tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: red;">Error during the device update</td></tr>';
	    });
	}

        function updateSortIcons() {
            const headers = document.querySelectorAll('.switch-table th');
            headers.forEach((header, index) => {
                const icon = header.querySelector('i');
                if (icon) {
                    if (index === currentSortColumn) {
                        icon.className = sortDirection === 1 ? 'fas fa-sort-up' : 'fas fa-sort-down';
                    } else {
                        icon.className = 'fas fa-sort';
                    }
                }
            });
        }

	function deleteSwitch(index) {
	    fetch('/get_switches')
	    .then(response => response.json())
	    .then(switchesData => {
		if (index >= 0 && index < switchesData.length) {
		    const hostname = switchesData[index].hostname;
		    
		    if (!confirm(`Are you sure you wanna deleted the device ${hostname}?`)) {
		        return;
		    }

		    fetch('/delete_switch', {
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/json',
		            'X-CSRFToken': getCSRFToken()
		        },
		        body: JSON.stringify({ index: index }),
		    })
		    .then(response => response.json())
		    .then(data => {
		        if (data.success) {
		            updateSwitchTable();
		            updateSchedulesList();
		            showStatus(`Device ${hostname} deleted successfully`, 'success');
		            addToLog(`Device ${hostname} removed from list`);
		        } else {
		            showStatus('Error: ' + data.message, 'error');
		            addToLog(`ERROR - device delete failed ${hostname}: ${data.message}`);
		        }
		    })
		    .catch(error => {
		        showStatus('Connection error: ' + error, 'error');
		        addToLog(`ERROR - device delete failed: ${error}`);
		    });
		}
	    });
	}

	function backupSwitch(index) {
	    // Prima recuperiamo i dati dello switch per ottenere l'hostname
	    fetch('/get_switches')
	    .then(response => response.json())
	    .then(switchesData => {
		if (index >= 0 && index < switchesData.length) {
		    const switchData = switchesData[index];
		    const statusMessage = `Starting backup for ${switchData.hostname} (${switchData.ip})...`;
		    showStatus(statusMessage, 'success');
		    addToLog(statusMessage);
		    
		    // Poi eseguiamo il backup
		    fetch('/backup_switch', {
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/json',
		            'X-CSRFToken': getCSRFToken()
		        },
		        body: JSON.stringify({ index: parseInt(index) }),
		    })
		    .then(response => response.json())
		    .then(data => {
		        if (data.success) {
		            const successMessage = `Backup completed for ${data.hostname}`;
		            showStatus(successMessage, 'success');
		            addToLog(successMessage);
		            addToLog(`Config saved at: ${data.filename}`);
		        } else {
		            const errorMessage = `Backup error for ${switchData.hostname}: ${data.message}`;
		            showStatus(errorMessage, 'error');
		            addToLog(`ERROR - backup failed for ${switchData.hostname}: ${data.message}`);
		        }
		    })
		    .catch(error => {
		        const errorMessage = `Connection error for ${switchData.hostname}: ${error}`;
		        showStatus(errorMessage, 'error');
		        addToLog(`ERROR - Connection failed for ${switchData.hostname}: ${error}`);
		    });
		}
	    })
	    .catch(error => {
		const errorMessage = `Error fetching switch data: ${error}`;
		showStatus(errorMessage, 'error');
		addToLog(`ERROR - Failed to get switch data: ${error}`);
	    });
	}

        function backupAllSwitches() {
            addToLog('Starting backup for all devices...');
            
            fetch('/backup_all_switches', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus(`Backup completato per ${data.count} switch`, 'success');
                    data.results.forEach(result => {
                        if (result.success) {
                            addToLog(`Backup completato per ${result.hostname} (${result.ip})`);
                        } else {
                            addToLog(`ERROR during the backup of ${result.hostname}: ${result.message}`);
                        }
                    });
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showStatus('Connection error: ' + error, 'error');
            });
        }


	function backupAllSwitches() {
	    const statusMessage = 'Starting backup for all devices...';
	    showStatus(statusMessage, 'success');
	    addToLog(statusMessage);
	    
	    fetch('/backup_all_switches', {
		method: 'POST',
		headers: {
		    'Content-Type': 'application/json',
		    'X-CSRFToken': getCSRFToken()
		},
	    })
	    .then(response => response.json())
	    .then(data => {
		if (data.success) {
		    const successMessage = `Backup completed for ${data.count} devices`;
		    showStatus(successMessage, 'success');
		    data.results.forEach(result => {
		        if (result.success) {
		            addToLog(`Backup completed for ${result.hostname} (${result.ip})`);
		        } else {
		            addToLog(`ERROR during the backup of ${result.hostname}: ${result.message}`);
		        }
		    });
		} else {
		    const errorMessage = `Backup error: ${data.message}`;
		    showStatus(errorMessage, 'error');
		}
	    })
	    .catch(error => {
		const errorMessage = `Connection error: ${error}`;
		showStatus(errorMessage, 'error');
	    });
	}
        function viewBackups(index) {
            fetch('/get_switch_backups', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({ index }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const modal = document.getElementById('backup-modal');
                    const switchName = document.getElementById('modal-switch-name');
                    const backupList = document.getElementById('backup-list');
                    
                    switchName.textContent = data.hostname;
                    backupList.innerHTML = '';
                    
                    if (data.backups.length === 0) {
                        backupList.innerHTML = '<p>No avalaible backup</p>';
                    } else {
                        data.backups.forEach(backup => {
                            const backupItem = document.createElement('div');
                            backupItem.className = 'backup-item';
                            backupItem.textContent = backup.filename;
                            backupItem.onclick = () => loadBackupContent(backup.path, index);
                            backupList.appendChild(backupItem);
                        });
                    }
                    
                    document.getElementById('backup-content').style.display = 'none';
                    document.getElementById('backup-content-placeholder').style.display = 'block';
                    modal.style.display = 'block';
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            });
        }
        
	function loadBackupContent(filepath, switchIndex) {
	    fetch('/get_backup_content', {
		method: 'POST',
		headers: {
		    'Content-Type': 'application/json',
		    'X-CSRFToken': getCSRFToken()
		},
		body: JSON.stringify({ filepath }),
	    })
	    .then(response => response.json())
	    .then(data => {
		if (data.success) {
		    const contentDiv = document.getElementById('backup-content');
		    const placeholder = document.getElementById('backup-content-placeholder');
		    const configContent = document.querySelector('#backup-content .config-content');
		    const deleteBtn = document.getElementById('delete-backup-btn');
		    const exportBtn = document.getElementById('export-backup-btn');
		    
		    configContent.textContent = data.content;
		    
		    contentDiv.style.display = 'flex';
		    placeholder.style.display = 'none';
		    deleteBtn.style.display = 'inline-block';
		    exportBtn.style.display = 'inline-block';
		    deleteBtn.setAttribute('data-filepath', filepath);
		    deleteBtn.setAttribute('data-switch-index', switchIndex);
		    
		    // Evidenzia il backup selezionato nella lista
		    document.querySelectorAll('.backup-item').forEach(item => {
		        item.classList.toggle('active', item.textContent.includes(data.filename));
		    });
		}
	    });
	}
	
	function exportBackup() {
	    const configContent = document.querySelector('#backup-content .config-content').textContent;
	    const filename = document.querySelector('.backup-item.active').textContent;
	    
	    // Crea un blob con il contenuto
	    const blob = new Blob([configContent], { type: 'text/plain' });
	    const url = URL.createObjectURL(blob);
	    
	    // Crea un link temporaneo e simula il click
	    const a = document.createElement('a');
	    a.href = url;
	    a.download = filename;
	    document.body.appendChild(a);
	    a.click();
	    
	    // Pulisci
	    document.body.removeChild(a);
	    URL.revokeObjectURL(url);
	    
	    showStatus('Backup exported successfully', 'success');
	    addToLog(`Exported backup: ${filename}`);
	}

	function deleteBackup() {
	    const currentBackupPath = document.getElementById('delete-backup-btn').getAttribute('data-filepath');
	    if (!currentBackupPath) return;

	    if (!confirm('Are you sure you want to delete this backup? This action cannot be undone.')) {
		return;
	    }

	    fetch('/delete_backup', {
		method: 'POST',
		headers: {
		    'Content-Type': 'application/json',
		    'X-CSRFToken': getCSRFToken()
		},
		body: JSON.stringify({ filepath: currentBackupPath }),
	    })
	    .then(response => response.json())
	    .then(data => {
		if (data.success) {
		    showStatus('Backup deleted successfully', 'success');
		    addToLog(`Deleted backup: ${currentBackupPath}`);
		    closeModal();
		    // Se stavi visualizzando i backup di uno switch specifico, potresti voler ricaricare la lista
		    const currentSwitchIndex = document.getElementById('delete-backup-btn').getAttribute('data-switch-index');
		    if (currentSwitchIndex) {
		        viewBackups(currentSwitchIndex);
		    }
		} else {
		    showStatus('Error: ' + data.message, 'error');
		}
	    })
	    .catch(error => {
		showStatus('Connection error: ' + error, 'error');
	    });
	}

	function copyToClipboard(element) {
	    const configContent = element.querySelector('pre').textContent;
	    navigator.clipboard.writeText(configContent).then(() => {
		const tooltip = element.querySelector('.tooltiptext');
		tooltip.textContent = '✓ Copied!';
		element.classList.add('copied');
		
		setTimeout(() => {
		    tooltip.textContent = 'Copy to clipboard';
		    element.classList.remove('copied');
		}, 2000);
	    }).catch(err => {
		console.error('Failed to copy: ', err);
		element.querySelector('.tooltiptext').textContent = '✗ Failed to copy!';
	    });
	}

	function closeModal() {
	    document.getElementById('backup-modal').style.display = 'none';
	    document.getElementById('delete-backup-btn').style.display = 'none';
	    document.getElementById('export-backup-btn').style.display = 'none';
	}

	function openEditModal(index) {
	    fetch('/get_switches')
	    .then(response => response.json())
	    .then(switchesData => {
		if (index >= 0 && index < switchesData.length) {
		    const switchData = switchesData[index];
		    
		    document.getElementById('edit-hostname').value = switchData.hostname;
		    document.getElementById('edit-ip').value = switchData.ip;
		    document.getElementById('edit-username').value = switchData.username;
		    document.getElementById('edit-password').value = '';
		    document.getElementById('edit-enable-password').value = '';
		    document.getElementById('edit-index').value = index;
		    
		    document.getElementById('edit-modal').style.display = 'block';
		}
	    });
	}

	function saveEditedSwitch() {
	    const index = document.getElementById('edit-index').value;
	    const hostname = document.getElementById('edit-hostname').value;
	    const ip = document.getElementById('edit-ip').value;
	    const username = document.getElementById('edit-username').value;
	    const password = document.getElementById('edit-password').value;
	    const enablePassword = document.getElementById('edit-enable-password').value;

	    if (!hostname || !ip || !username) {
		showStatus('Please fill all required fields', 'error');
		return;
	    }

	    const switchData = { 
		index: parseInt(index),
		hostname: hostname,
		ip: ip,
		username: username
	    };
	    
	    if (password) {
		switchData.password = password;
	    }
	    
	    if (enablePassword) {
		switchData.enable_password = enablePassword;
	    }
	    
	    fetch('/update_switch', {
		method: 'POST',
		headers: {
		    'Content-Type': 'application/json',
		    'X-CSRFToken': getCSRFToken()
		},
		body: JSON.stringify(switchData),
	    })
	    .then(response => response.json())
	    .then(data => {
		if (data.success) {
		    updateSwitchTable();
		    updateSchedulesList();
		    closeEditModal();
		    showStatus('Device data updated successfully', 'success');
		    addToLog(`Device ${hostname} (${ip}) data updated`);
		} else {
		    showStatus('Error: ' + data.message, 'error');
		}
	    });
	}

	function closeEditModal() {
	    document.getElementById('edit-modal').style.display = 'none';
	}

	function showStatus(message, type) {
	    const statusElement = document.getElementById('status-message');
	    statusElement.textContent = message;
	    statusElement.className = 'status ' + type;
	    statusElement.style.display = 'block';
	    
	    // Auto-hide after 5 seconds
	    setTimeout(() => {
		statusElement.style.display = 'none';
	    }, 5000);
	}

	function addToLog(message) {
	    const logElement = document.getElementById('log');
	    const timestamp = new Date().toLocaleTimeString();
	    const messageDiv = document.createElement('div');
	    messageDiv.textContent = `[${timestamp}] ${message}`;
	    
	    // Aggiunge classi in base al tipo di messaggio
	    if (message.includes('ERROR:')) {
		messageDiv.style.color = '#ff6b6b';
	    } else if (message.includes('Starting') || message.includes('Connected') || message.includes('Executing')) {
		messageDiv.style.color = '#51cf66';
	    } else if (message.includes('completed')) {
		messageDiv.style.color = '#339af0';
	    }
	    
	    logElement.insertBefore(messageDiv, logElement.firstChild);
	    logElement.scrollTop = 0;
	}

	function colorLogLine(line) {
	    const lowerLine = line.toLowerCase();
	    if (lowerLine.includes('error') || lowerLine.includes('failed')) {
		return `<div class="log-line error">${line}</div>`;
	    } else if (lowerLine.includes('warning')) {
		return `<div class="log-line warning">${line}</div>`;
	    } else if (lowerLine.includes('success') || lowerLine.includes('completed')) {
		return `<div class="log-line success">${line}</div>`;
	    }
	    return `<div class="log-line">${line}</div>`;
	}



	function viewFullLog() {
	    fetch('/get_full_log')
	    .then(response => response.json())
	    .then(data => {
		if (data.success) {
		    const modal = document.getElementById('log-modal');
		    const logContent = document.getElementById('full-log-content');
		    
		    // Pulisci e formatta il log
			const lines = data.log.match(/[^\\r\\n]+/g) || [];
			logContent.innerHTML = lines
			    .filter(line => line.trim())
			    .map(line => `<div class="log-line">${line}</div>`)
			    .join('');
		        
		    modal.style.display = 'block';
		} else {
		    showStatus('Error: ' + data.message, 'error');
		}
	    });
	}

        function closeLogModal() {
            document.getElementById('log-modal').style.display = 'none';
        }

	window.onclick = function(event) {
	    const backupModal = document.getElementById('backup-modal');
	    const editModal = document.getElementById('edit-modal');
	    const logModal = document.getElementById('log-modal');
	    
	    if (event.target === backupModal) {
		backupModal.style.display = 'none';
	    }
	    if (event.target === editModal) {
		editModal.style.display = 'none';
	    }
	    if (event.target === logModal) {
		logModal.style.display = 'none';
	    }
	}

        function showScheduleOptions() {
            const type = document.getElementById('schedule-type').value;
            document.querySelectorAll('.schedule-option').forEach(option => {
                option.classList.remove('active');
            });
            
            if (type === 'once') {
                document.getElementById('once-option').classList.add('active');
            } else if (type === 'weekly') {
                document.getElementById('weekly-option').classList.add('active');
            } else if (type === 'monthly') {
                document.getElementById('monthly-option').classList.add('active');
            } else if (type === 'yearly') {
                document.getElementById('yearly-option').classList.add('active');
            }
        }

        function addSchedule() {
            const type = document.getElementById('schedule-type').value;
            const time = document.getElementById('schedule-time').value;
            
            const scheduleData = {
                type: type,
                time: time,
                enabled: true
            };
            
            if (type === 'once') {
                const date = document.getElementById('schedule-date').value;
                if (!date) {
                    showStatus('Seleziona una data valida', 'error');
                    return;
                }
                scheduleData.date = date;
            } else if (type === 'weekly') {
                scheduleData.day_of_week = document.getElementById('schedule-day-week').value;
            } else if (type === 'monthly') {
                scheduleData.day = document.getElementById('schedule-day-month').value;
            } else if (type === 'yearly') {
                scheduleData.month = document.getElementById('schedule-month').value;
                scheduleData.day = document.getElementById('schedule-day-year').value;
            }
            
            fetch('/add_schedule', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify(scheduleData),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus('Pianificazione aggiunta con successo', 'success');
                    updateSchedulesList();
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            });
        }

        function updateSchedulesList() {
            fetch('/get_schedules')
            .then(response => response.json())
            .then(schedules => {
                const list = document.getElementById('schedules-list');
                list.innerHTML = '';
                
                if (schedules.length === 0) {
                    list.innerHTML = '<p>No active schedule</p>';
                    return;
                }
                
                schedules.forEach(schedule => {
                    const item = document.createElement('div');
                    item.className = 'schedule-item';
                    
                    const description = getScheduleDescription(schedule);
                    
                    item.innerHTML = `
                        <div class="schedule-item-header">
                            <span>${description}</span>
                            <div class="schedule-item-actions">
                                <button class="action-btn ${schedule.enabled ? 'edit-btn' : 'backup-btn'}" 
                                    onclick="toggleSchedule('${schedule.id}', ${!schedule.enabled})">
                                    <i class="fas fa-${schedule.enabled ? 'pause' : 'play'}"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteSchedule('${schedule.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div>Backup globale di tutti gli switch</div>
                        <div>Prossima esecuzione: ${schedule.next_run || 'N/A'}</div>
                    `;
                    
                    list.appendChild(item);
                });
            });
        }

        function toggleSchedule(scheduleId, enable) {
            fetch('/toggle_schedule', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({ id: scheduleId, enabled: enable }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus(`Pianificazione ${enable ? 'attivata' : 'disattivata'}`, 'success');
                    updateSchedulesList();
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            });
        }

        function deleteSchedule(scheduleId) {
            if (!confirm('Sei sicuro di voler eliminare questa pianificazione?')) {
                return;
            }
            
            fetch('/delete_schedule', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({ id: scheduleId }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus('Pianificazione eliminata', 'success');
                    updateSchedulesList();
                } else {
                    showStatus('Error: ' + data.message, 'error');
                }
            });
        }

        function getScheduleDescription(schedule) {
            let desc = '';
            const time = schedule.time || '00:00';
            
            switch (schedule.type) {
                case 'once':
                    desc = `Una volta il ${schedule.date} alle ${time}`;
                    break;
                case 'daily':
                    desc = `Giornaliero alle ${time}`;
                    break;
                case 'weekly':
                    const days = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'];
                    desc = `Settimanale ogni ${days[parseInt(schedule.day_of_week)]} alle ${time}`;
                    break;
                case 'monthly':
                    desc = `Mensile il giorno ${schedule.day} alle ${time}`;
                    break;
                case 'yearly':
                    const months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                                  'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
                    desc = `Annuale il ${schedule.day} ${months[parseInt(schedule.month) - 1]} alle ${time}`;
                    break;
            }
            
            return desc;
        }
	function getCSRFToken() {
	    const name = 'csrf_token';
	    const cookies = document.cookie.split(';');
	    for (let cookie of cookies) {
		let [key, value] = cookie.trim().split('=');
		if (key === name) return decodeURIComponent(value);
	    }
	    return '';
	}

        function exportSwitchesToCSV() {
            fetch('/export_switches_csv')
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'switches_backup_' + new Date().toISOString().slice(0, 10) + '.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showStatus('Esportazione CSV completata', 'success');
                addToLog('Esportata lista switch in formato CSV');
            });
        }

	document.addEventListener('DOMContentLoaded', function() {
	    updateSwitchTable();
	    showScheduleOptions();
	    updateSchedulesList();
	    
	    const today = new Date().toISOString().split('T')[0];
	    document.getElementById('schedule-date').min = today;
	    document.getElementById('schedule-date').value = today;
	    
	    // Aggiungi event listener per la ricerca
	    document.getElementById('search-input').addEventListener('input', filterSwitches);
	    document.getElementById('delete-backup-btn').addEventListener('click', deleteBackup);
	    document.getElementById('export-backup-btn').addEventListener('click', exportBackup);
	});
    </script>
</body>
</html>
"""

# HTML_TEMPLATE = HTML_TEMPLATE.replace('__pickledlogo__', __pickledlogo__)

if __name__ == '__main__':
	app.run(host='0.0.0.0', port=5000, debug=False)

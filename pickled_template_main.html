<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PICKLED – Because broken routers don’t explain themselves</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
        <link rel="icon" type="image/png" href="data:image/png;base64,{{ favicon }}">
        <style>
            {pickled_style_template}
        </style>
    </head>

    <body>
        <div class="status-container">
            <div id="status-message" class="status"></div>
        </div>

        <div class="app-container">
            <div class="left-panel">
                <h2>Add device</h2>
                <div class="form-group">
                    <label for="hostname">Hostname:</label>
                    <input type="text" id="hostname" placeholder="Es: Switch1">
                </div>
                <div class="form-group">
                    <label for="ip">IP Address:</label>
                    <input type="text" id="ip" placeholder="Es: 192.168.1.1">
                </div>
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" placeholder="Username SSH">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Password SSH">
                </div>
                <div class="form-group">
                    <label for="enable-password">Enable Password (optional):</label>
                    <input type="password" id="enable-password" placeholder="Enable/Secret password">
                </div>

                <div class="form-group">
                    <label for="device-type">Device Type:</label>
                    <select id="device-type" class="form-control">
                        <option value="cisco_ios">cisco_ios</option>
                        <option value="cisco_xe">cisco_xe</option>
                        <option value="cisco_xr">cisco_xr</option>
                        <option value="huawei">huawei</option>
                        <option value="juniper_junos">juniper_junos</option>
                        <option value="mellanox">mellanox</option>
                        <option value="mellanox_mlnxos">mellanox_mlnxos</option>
                    </select>
                </div>

                <button onclick="addSwitch()" class="addsw-btn">Add Device</button>

                <h2 style="margin-top: 30px;">Load CSV</h2>
                <div class="file-input-container">
                    <label class="file-input-label" for="csv-file">Select CSV file:</label>
                    <input type="file" id="csv-file" class="file-input" accept=".csv">
                </div>

                <button class="csv-btn" onclick="uploadCSV()">
                    <i class="fas fa-file-import"></i> Load CSV
                </button>

                <div class="version-footer">
                    PICKLED v{{ version }}<br/>Network Configuration Manager
                </div>
            </div>

            <div class="center-panel">
                <div class="device-list-background"></div>

                <div class="search-header-container">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="margin: 0;">Device List</h2>
                        <div class="search-buttons-container">
                            <div style="position: relative;">
                                <input type="text" id="search-input" placeholder="Search devices..."
                                style="padding: 5px 30px 5px 10px; border: 1px solid #ddd; border-radius: 4px; height: 30px; margin-right: 10px;"
                                oninput="filterSwitches(); toggleSearchIcon()">
                                <i id="search-icon" class="fas fa-search" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #777; cursor: pointer;" onclick="clearSearch()"></i>
                            </div>
                            <button class="search-button exp-btn" onclick="exportSwitchesToCSV()">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                            <button class="search-button backup-btn" onclick="backupAllSwitches()">
                                <i class="fas fa-download"></i> Backup All
                            </button>
                            <button class="search-button logout-btn" onclick="window.location.href='/logout'">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>

                <div class="switch-table-container">
                    <table class="switch-table">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">Hostname <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(1)">IP <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(2)">Username <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(3)">Type <i class="fas fa-sort"></i></th>
                                <th>Actions
                                    <span class="per-page-selector">
                                        <select id="items-per-page" onchange="changeItemsPerPage()">
                                            <option value="5">5</option>
                                            <option value="10">10</option>
                                            <option value="15" selected>15</option>
                                            <option value="20">20</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </span>
                                </th>
                            </tr>
                        </thead>

                        <tbody id="switch-table-tbody" class="switch-table-tbody">
                        <!-- Le righe della tabella verranno aggiunte qui dinamicamente -->
                        </tbody>
                    </table>
                </div>

                <!-- Paginazione -->
                <div class="pagination" id="pagination">
                <!-- Popolato dinamicamente da JavaScript -->
                </div>
            </div>

            <!-- Colonna destra - Scheduler e log -->
            <div class="right-panel">
                <h2>Backup Scheduler</h2>

                <div class="schedule-form">
                    <h3>New Schedule</h3>

                    <div class="form-group">
                        <label for="schedule-type">Type:</label>
                        <select id="schedule-type" class="form-control" onchange="showScheduleOptions()">
                            <!--<option value="once">One Time</option>-->
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="schedule-time">Hour:</label>
                        <input type="time" id="schedule-time" class="form-control" value="00:00">
                    </div>

                    <!-- Opzioni specifiche per tipo -->
                    <div id="once-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-date">Data:</label>
                            <input type="date" id="schedule-date" class="form-control">
                        </div>
                    </div>

                    <div id="weekly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-day-week">Giorno settimana:</label>
                            <select id="schedule-day-week" class="form-control">
                                <option value="0">Monday</option>
                                <option value="1">Tuesday</option>
                                <option value="2">Wednesday</option>
                                <option value="3">Thursday</option>
                                <option value="4">Friday</option>
                                <option value="5">Saturday</option>
                                <option value="6">Sunday</option>
                            </select>
                        </div>
                    </div>

                    <div id="monthly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-day-month">Day month:</label>
                            <input type="number" id="schedule-day-month" min="1" max="31" value="1" class="form-control">
                        </div>
                    </div>

                    <div id="yearly-option" class="schedule-option">
                        <div class="form-group">
                            <label for="schedule-month">Month:</label>
                            <select id="schedule-month" class="form-control">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="schedule-day-year">Day:</label>
                            <input type="number" id="schedule-day-year" min="1" max="31" value="1" class="form-control">
                        </div>
                    </div>

                    <button onclick="addSchedule()" class="backup-btn">
                        <i class="fas fa-calendar-plus"></i> Add Schedule
                    </button>
                </div>

                <div class="schedule-list" id="schedules-list">
                <!-- Lista delle pianificazioni verrà popolata dinamicamente -->
                </div>


                <div id="status-message" class="status"></div>

                <h2 style="margin-top: 30px;">Activity Log</h2>
                <div id="log" class="log">Ready to backup...</div>

                <button onclick="openLogModal()" style="margin-top: 10px; width: 100%;">
                    <i class="fas fa-scroll"></i> Show log
                </button>
            </div>
        </div>

        <!-- Modal con l'elenco dei backup -->
        <div id="backup-list-modal" class="modal" style="z-index:1000">
            <div class="modal-content" style="width: 95%; max-width: 1600px; height: 90vh;">
                <div class="modal-header">
                    <div class="modal-title">
                        Available backup by <span id="modal-switch-name"></span>
                    </div>
                    <span class="close-btn" onclick="closeConfigModal()">&times;</span>
                </div>

                <div class="modal-body" style="height: calc(100% - 60px);">
                    <!-- Lista backup più stretta (25%) -->
                    <div class="backup-list-container" id="backup-list-container" style="width: 25%; min-width: 220px; border-right: 1px solid #eee; padding-right: 15px;">
                        <button class="action-btn export-all-btn" id="export-all-backup-btn" style="padding: 5px 12px; font-size: 13px;" onclick="exportAllBackup()">
                            <i class="fa-solid fa-code-compare"></i> Export All
                        </button>
                        <div class="backup-list" id="backup-list">
                        <!-- Lista dei backup generata dinamicamente -->
                        </div>
                    </div>

                    <!-- Contenuto principale più ampio (75%) -->
                    <div class="backup-content" style="width: 75%;">
                        <div id="backup-content-placeholder">
                            <i class="fas fa-arrow-left" style="font-size: 24px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>Select a backup from the list to view content</p>
                        </div>

                        <div id="backup-content" style="display: none; flex-direction: column; height: 100%;">
                            <!-- Barra dei bottoni compatta -->
                            <div id="backup-button-bar" style="display: flex; justify-content: flex-end; gap: 8px; padding: 8px 0; margin-bottom: 12px;">
                                <!-- to be filled by the script -->
                            </div>

                            <!-- Contenuto configurazione -->
                            <div class="config-container" style="flex: 1; overflow-y: auto; background: #f8f8f8; border-radius: 4px; padding: 15px;">
                                <div class="copy-tooltip" onclick="copyToClipboard(this)" style="position: relative;">
                                    <span class="tooltiptext">Copy to clipboard</span>
                                    <pre class="config-content" style="white-space: pre-wrap; margin: 0; font-family: 'Consolas', monospace; font-size: 13px;"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal con l'elenco dei backup da confrontare -->
        <div id="compare-select-modal" class="modal" style="z-index:1010">
            <div class="modal-content" style="width: 95%; max-width: 1600px; height: 90vh;">
                <div class="modal-header">
                    <div class="modal-title">
                        Select which backup of <span id="compare-select-switch-name"></span> to compare
                    </div>
                    <button class="action-btn compare-confirm-btn" id="compare-confirm-btn" onclick="startConfigurationCompare()" style="padding: 5px 12px; font-size: 13px;">
                        <i class="fa-solid fa-code-compare"></i>Let's Compare !
                    </button>
                    <span class="close-btn" onclick="closeCompareSelectModal()">&times;</span>
                </div>

                <div class="modal-body" style="height: calc(100% - 60px);">
                    <!-- Lista backup larghezza 25% -->
                    <div class="backup-list-container" id="backup-list-container" style="width: 25%; min-width: 220px; border-right: 1px solid #eee; padding-right: 15px;">
                        <div class="backup-list" id="compare-backup-list">
                        <!-- Lista backup generata dinamicamente -->
                        </div>
                    </div>

                    <!-- Contenuto principale larghezza 75% -->
                    <div class="backup-content" style="width: 75%;">
                        <div id="compare-backup-content-placeholder">
                            <i class="fas fa-arrow-left" style="font-size: 24px; color: #ccc; margin-bottom: 10px;"></i>
                            <p>Select a backup from the list to view content</p>
                        </div>

                        <div id="compare-backup-content" style="display: none; flex-direction: column; height: 100%;">
                            <!-- Contenuto configurazione -->
                            <div class="config-container" style="flex: 1; overflow-y: auto; background: #f8f8f8; border-radius: 4px; padding: 15px;">
                                <div class="copy-tooltip" style="position: relative;">
                                    <span class="tooltiptext">Copy to clipboard</span>
                                    <pre class="config-content" style="white-space: pre-wrap; margin: 0; font-family: 'Consolas', monospace; font-size: 13px;"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal con il confronto delle configurazioni -->
        <div id="config-compare-modal" class="modal" style="z-index:1020">
            <div class="modal-content" style="width: 95%; max-width: 1600px; height: 90vh;">
                <div class="modal-header">
                    <div class="modal-title">
                        Configuration comparison of <span id="comparison-switch-name"></span>
                        <div class="compare-controls">
                            <div class="compare-search">
                                <input type="text" id="compare-search-input" placeholder="Search in config...">
                                <button onclick="highlightSearchMatches(document.getElementById('compare-search-input').value)">
                                <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div class="compare-filters">
                                <label>
                                    <input type="checkbox" id="filter-added" checked onchange="toggleFilter('added')">
                                    <span style="color:#4caf50">Added</span>
                                </label>
                                <label>
                                    <input type="checkbox" id="filter-removed" checked onchange="toggleFilter('removed')">
                                    <span style="color:#f44336">Removed</span>
                                </label>
                                <label>
                                    <input type="checkbox" id="filter-unchanged" onchange="toggleFilter('unchanged')">
                                    <span style="color:#777">Unchanged</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="compare-stats">
                        <span id="stats-lines">0 lines</span>
                        <span id="stats-added" style="color:#4caf50">+0</span>
                        <span id="stats-removed" style="color:#f44336">-0</span>
                    </div>
                    <span class="close-btn" onclick="closeCompareModal()">&times;</span>
                </div>
                <div class="modal-body" style="height: calc(100% - 60px);">
                    <div class="compare-container">
                        <!-- Left Panel -->
                        <div class="compare-panel">
                            <div class="compare-header">
                                <span id="left-file-info"></span>
                            </div>
                            <div class="compare-content" id="left-config-content"></div>
                        </div>

                        <!-- Right Panel -->
                        <div class="compare-panel">
                            <div class="compare-header">
                                <span id="right-file-info"></span>
                            </div>
                            <div class="compare-content" id="right-config-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal per modificare switch -->
        <div id="edit-modal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <div class="modal-title">Modify Device</div>
                    <span class="close-btn" onclick="closeEditModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="split-view">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="edit-hostname">Hostname:</label>
                                <input type="text" id="edit-hostname">
                            </div>
                            <div class="form-group">
                                <label for="edit-ip">IP Address:</label>
                                <input type="text" id="edit-ip">
                            </div>
                            <div class="form-group">
                                <label for="edit-device-type">Device Type:</label>
                                <select id="edit-device-type" class="form-control">
                                    <option value="cisco_ios">cisco_ios</option>
                                    <option value="cisco_xe">cisco_xe</option>
                                    <option value="cisco_xr">cisco_xr</option>
                                    <option value="huawei">huawei</option>
                                    <option value="juniper_junos">juniper_junos</option>
                                    <option value="mellanox">mellanox</option>
                                    <option value="mellanox_mlnxos">mellanox_mlnxos</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="edit-username">Username:</label>
                                <input type="text" id="edit-username">
                            </div>
                            <div class="form-group">
                                <label for="edit-password">Password:</label>
                                <input type="password" id="edit-password" placeholder="Leave blank to keep current">
                            </div>
                            <div class="form-group">
                                <label for="edit-enable-password">Enable Password:</label>
                                <input type="password" id="edit-enable-password" placeholder="Leave blank to keep current">
                            </div>
                        </div>
                    </div>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeEditModal()">Cancel</button>
                    <button class="backup-btn" onclick="saveEditedSwitch()" style="margin-left: 10px;">Save changes</button>
                </div>
                <input type="hidden" id="edit-index">
            </div>
        </div>

        <!-- Modal per visualizzare il log completo -->
        <div id="log-modal" class="modal">
            <div class="log-modal-content">
                <div class="modal-header">
                    <div class="modal-title">Complete log activity</div>
                    <span class="close-btn" onclick="closeLogModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="full-log-content" class="log-content"></div>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeLogModal()">Close</button>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/diff/5.0.0/diff.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/4.0.2/diff.min.js"></script>

        <script>
            {pickled_js_template}
        </script>
    </body>
</html>